import{b as _,c as v}from"./chunk-GG2PNM2J.js";import{b as ne}from"./chunk-LCRFK72W.js";import{a as te}from"./chunk-ZWHC7VKH.js";import{a as W}from"./chunk-ZDGXBWHY.js";import{d as H,g as z,h as J,i as Y,k as K,l as X,m as Z,w as ee}from"./chunk-AVVPDZJM.js";import{a as le}from"./chunk-QMQTSFHS.js";import"./chunk-FK6H3RFT.js";import{a as x}from"./chunk-SQ767D7R.js";import{k as V}from"./chunk-MTNE5NEP.js";import{Ab as B,Eb as j,Hb as g,Ic as L,Jb as F,Lc as G,Nc as U,Oc as $,Ua as a,Ub as n,Va as D,Vb as c,Wb as k,Xb as N,Yb as q,Zb as Q,_b as R,aa as p,ac as y,ea as C,ec as d,gc as A,ic as u,ma as w,na as T,nb as E,pb as S,yb as e,zb as t}from"./chunk-X4DW4WN7.js";import{e as ae}from"./chunk-EQDQRRRY.js";var I=class l{logocondor="/img/logo.png";userInfor;saldoInicial=1e3;_BaseApi=p(v);_SweetAlert=p(_);sTitle=p(x);ngOnInit(){this.sTitle.setTitle("Apertura de caja")}onSubmit(){this._SweetAlert.showLoading();let o={openingAmount:this.saldoInicial};this._BaseApi.addItem("cashSession",o).subscribe(i=>{i.isSuccess?this._SweetAlert.showSuccess("Apertura Correcta"):this._SweetAlert.showError(i.error||"Error al registrar la apertura.")})}static \u0275fac=function(i){return new(i||l)};static \u0275cmp=C({type:l,selectors:[["app-apertura"]],standalone:!0,features:[y],decls:10,vars:1,consts:[[1,"apertura-caja"],[3,"ngSubmit"],["for","saldoInicial"],["type","number","id","saldoInicial","name","saldoInicial",3,"ngModelChange","ngModel"],["type","submit",1,"btn","btn-primary","btn-lg"]],template:function(i,r){i&1&&(e(0,"div",0)(1,"h2"),n(2,"Apertura de Caja"),t(),e(3,"form",1),g("ngSubmit",function(){return r.onSubmit()}),e(4,"div")(5,"label",2),n(6,"Saldo Inicial:"),t(),e(7,"input",3),R("ngModelChange",function(m){return Q(r.saldoInicial,m)||(r.saldoInicial=m),m}),t()(),e(8,"button",4),n(9,"Registrar Apertura"),t()()()),i&2&&(a(7),q("ngModel",r.saldoInicial))},dependencies:[ee,X,H,Z,z,J,K,Y],styles:[".apertura-caja[_ngcontent-%COMP%]{max-width:600px;margin:auto;padding:20px;border:1px solid #ccc;border-radius:8px;box-shadow:0 2px 5px #0000001a;background-color:#f9f9f9}h2[_ngcontent-%COMP%]{text-align:center;color:#333}div[_ngcontent-%COMP%]{margin-bottom:15px}label[_ngcontent-%COMP%]{display:block;margin-bottom:5px;font-weight:700}input[_ngcontent-%COMP%]{width:100%;padding:8px;border:1px solid #ccc;border-radius:4px;transition:border-color .3s}input[_ngcontent-%COMP%]:focus{border-color:#007bff;outline:none}.btn[_ngcontent-%COMP%]{width:100%;padding:10px;font-size:16px;border:none;border-radius:4px;transition:background-color .3s}.btn-primary[_ngcontent-%COMP%]{background-color:#007bff;color:#fff}.btn-primary[_ngcontent-%COMP%]:hover{background-color:#0056b3}"]})};var ie=ae(le());function ce(l,o){if(l&1){let i=j();e(0,"tr")(1,"td"),n(2),t(),e(3,"td")(4,"input",11),g("input",function(s){let m=w(i).$implicit,h=F();return T(h.updateSubtotal(m,s))}),t()(),e(5,"td"),n(6),d(7,"currency"),t()()}if(l&2){let i=o.$implicit;a(2),c(i.label),a(2),S("value",i.quantity),a(2),c(u(7,3,i.subtotal,"GTQ","symbol","1.2-2"))}}function de(l,o){if(l&1&&(e(0,"tr")(1,"td"),n(2),t(),e(3,"td"),n(4),d(5,"currency"),t(),e(6,"td"),n(7),d(8,"currency"),t(),e(9,"td"),n(10),d(11,"currency"),t(),e(12,"td"),n(13),d(14,"currency"),t()()),l&2){let i=o.$implicit;a(2),c(i.descripcion),a(2),c(u(5,5,i.saldoAnterior,"GTQ","symbol","1.2-2")),a(3),c(u(8,10,i.entradas,"GTQ","symbol","1.2-2")),a(3),c(u(11,15,i.salidas,"GTQ","symbol","1.2-2")),a(3),c(u(14,20,i.total,"GTQ","symbol","1.2-2"))}}var M=class l{constructor(o){this.authService=o}logocondor="/img/logo.png";userInfor;currentDate=new Date;totalAmount=0;_BaseApi=p(v);_SweetAlert=p(_);baseOpenCash=0;dateOpenCash=0;sTitle=p(x);intervalId;denominations=[{label:"Billetes de Q5.00",value:5,quantity:0,subtotal:0},{label:"Billetes de Q10.00",value:10,quantity:0,subtotal:0},{label:"Billetes de Q20.00",value:20,quantity:0,subtotal:0},{label:"Billetes de Q50.00",value:50,quantity:0,subtotal:0},{label:"Billetes de Q100.00",value:100,quantity:0,subtotal:0},{label:"Billetes de Q200.00",value:200,quantity:0,subtotal:0},{label:"Monedas de Q1.00",value:1,quantity:0,subtotal:0},{label:"Monedas de Q0.50",value:.5,quantity:0,subtotal:0},{label:"Monedas de Q0.25",value:.25,quantity:0,subtotal:0}];importes=[{descripcion:"Total Ventas",saldoAnterior:0,entradas:0,salidas:0,total:0}];user;ngOnInit(){this.sTitle.setTitle("Cierre de caja"),this.authService.getProfile().subscribe(o=>{o.isSuccess&&(this.userInfor=o.value)}),this._BaseApi.getItems("cashSession").subscribe(o=>{o.isSuccess&&(this.baseOpenCash=o.value.openingAmount,this.dateOpenCash=o.value.openDate)}),this.intervalId=setInterval(()=>{this.currentDate=new Date},1e3)}onCloseCashSession(){let o={reportedClosingAmount:this.totalAmount};this._BaseApi.closeCashSession(o).subscribe(i=>{i.isSuccess?this._SweetAlert.showSuccess("La sesi\xF3n de caja se cerr\xF3 con \xE9xito"):this._SweetAlert.showError(i.error||"No hay una sesi\xF3n de caja iniciada")})}ngOnDestroy(){clearInterval(this.intervalId)}get total(){return this.totalAmount=this.denominations.reduce((o,i)=>o+i.subtotal,0),this.totalAmount}updateSubtotal(o,i){let r=i.target,s=parseInt(r.value,10);o.quantity=isNaN(s)?0:s,o.subtotal=o.value*o.quantity}exportToPDF(){let o=document.getElementById("reportContent"),i=new ne("p","mm","a4");if(!o){console.error('El contenedor con ID "reportContent" no se encontr\xF3.');return}let r=new Date,s=r.toLocaleDateString("es-GT"),m=r.toLocaleTimeString("es-GT"),h=document.getElementById("reportDate"),O=document.getElementById("reportMonth"),P=document.getElementById("reportUser");h&&(h.textContent=` ${s}, ${m}`),O&&(O.textContent=` ${r.toLocaleString("default",{month:"long"})} ${r.getFullYear()}`),P&&(P.textContent=` ${this.userInfor?.firstname} ${this.userInfor?.lastname}`);let f=document.querySelector(".action-buttons");f&&(f.style.display="none"),(0,ie.default)(o,{useCORS:!0,allowTaint:!0}).then(b=>{let oe=b.height*208/b.width,re=b.toDataURL("image/png");i.addImage(re,"PNG",0,0,208,oe),i.save(`reporte-usuarios-${s}-${m}.pdf`),f&&(f.style.display="flex")}).catch(b=>{console.error("Error al generar el PDF:",b),f&&(f.style.display="flex")})}static \u0275fac=function(i){return new(i||l)(D(W))};static \u0275cmp=C({type:l,selectors:[["app-cierre"]],standalone:!0,features:[y],decls:75,vars:19,consts:[["id","reportContent",1,"report-container"],[1,"header-info"],[1,"main-content"],[1,"denominations"],[1,"table-container"],[4,"ngFor","ngForOf"],[1,"total"],[1,"importes"],[1,"action-buttons"],[3,"click"],["type","button",1,"btn","btn-primary","btn-lg",3,"click"],["type","number","min","0",3,"input","value"]],template:function(i,r){i&1&&(e(0,"div",0)(1,"header")(2,"h1"),n(3,"Cierre de Caja"),t(),e(4,"div",1)(5,"div")(6,"label"),n(7,"Nombre del Usuario/Cajero:"),t(),e(8,"span"),n(9),t()(),e(10,"div")(11,"label"),n(12,"Caja:"),t(),e(13,"span"),n(14,"001"),t()(),e(15,"div")(16,"label"),n(17,"Fecha de Apertura:"),t(),e(18,"span"),n(19),d(20,"date"),t()(),e(21,"div")(22,"label"),n(23,"Fecha de Cierre:"),t(),e(24,"span"),n(25),d(26,"date"),t()(),e(27,"div")(28,"label"),n(29,"Base en caja:"),t(),e(30,"span"),n(31),t()()()(),e(32,"div",2)(33,"section",3)(34,"h2"),n(35,"Denominaciones"),t(),e(36,"div",4)(37,"table")(38,"thead")(39,"tr")(40,"th"),n(41,"Denominaci\xF3n"),t(),e(42,"th"),n(43,"Cantidad"),t(),e(44,"th"),n(45,"Subtotal"),t()()(),e(46,"tbody"),E(47,ce,8,8,"tr",5),t()()(),B(48,"br"),e(49,"p",6),n(50),d(51,"currency"),t()(),e(52,"section",7)(53,"h2"),n(54,"Importes de Caja"),t(),e(55,"table")(56,"thead")(57,"tr")(58,"th"),n(59,"Descripci\xF3n"),t(),e(60,"th"),n(61,"Saldo Anterior"),t(),e(62,"th"),n(63,"Entradas/Cobros"),t(),e(64,"th"),n(65,"Salida/Pagos"),t(),e(66,"th"),n(67,"Total"),t()()(),e(68,"tbody"),E(69,de,15,25,"tr",5),t()()()(),e(70,"div",8)(71,"button",9),g("click",function(){return r.exportToPDF()}),n(72,"Exportar a PDF"),t(),e(73,"button",10),g("click",function(){return r.onCloseCashSession()}),n(74,"Cerrar Caja"),t()()()),i&2&&(a(9),N("",r.userInfor==null?null:r.userInfor.firstname," ",r.userInfor==null?null:r.userInfor.lastname,""),a(10),c(A(20,8,r.dateOpenCash,"dd/MM/yyyy")),a(6),c(A(26,11,r.currentDate,"dd/MM/yyyy")),a(6),c(r.baseOpenCash),a(16),S("ngForOf",r.denominations),a(3),k("Total Efectivo: ",u(51,14,r.total,"GTQ","symbol","1.2-2"),""),a(19),S("ngForOf",r.importes))},dependencies:[$,L,U,G],styles:["body[_ngcontent-%COMP%]{font-family:Arial,sans-serif;background-color:#f4f4f4;padding:20px}.report-container[_ngcontent-%COMP%]{margin:auto;background-color:#fff;padding:20px;border-radius:10px;box-shadow:0 0 10px #0000001a}header[_ngcontent-%COMP%]{text-align:center;margin-bottom:20px}h1[_ngcontent-%COMP%]{font-size:54px;color:#ff9f43}.header-info[_ngcontent-%COMP%]{display:flex;justify-content:space-around;margin-top:20px}.header-info[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{margin:10px 0}label[_ngcontent-%COMP%]{font-weight:700;color:#333}section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{background-color:#ff9f43;color:#fff;padding:10px;margin-top:20px}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin-top:10px}table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px;border:1px solid #ccc;text-align:left}thead[_ngcontent-%COMP%]{background-color:#ff9f43;color:#fff}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f9f9f9}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(odd){background-color:#fff}.action-buttons[_ngcontent-%COMP%]{margin-top:20px;display:flex;justify-content:space-between}button[_ngcontent-%COMP%]{padding:10px 20px;background-color:#ff9f43;color:#fff;border:none;border-radius:5px;cursor:pointer}button[_ngcontent-%COMP%]:hover{background-color:#048600}"]})};var Qe=[{path:"apertura",component:I,canActivate:[()=>p(te).isTokenExpired()?(p(V).navigate(["/iniciarSesion"]),!1):!0]},{path:"cierre",component:M},{path:"",redirectTo:"apertura",pathMatch:"full"}];export{Qe as CAJA_ROUTES};
