import{b as ht,c as bt,h as U,i as $,j as Vt,k as Tt}from"./chunk-QHK7MVTD.js";import{a as k,b as j}from"./chunk-VPRBATIL.js";import{d as _t}from"./chunk-XMJKV3Y7.js";import"./chunk-E4NSLAU5.js";import"./chunk-AESYL7IM.js";import"./chunk-UZQ2FFVI.js";import{a as At}from"./chunk-X7UD6IQT.js";import{b as kt}from"./chunk-LCRFK72W.js";import{a as W}from"./chunk-WKFV6RTR.js";import{a as T}from"./chunk-I5BED3QL.js";import{d as ct,g as dt,k as pt,m as mt,t as ut,w as gt}from"./chunk-AQA36TAA.js";import{a as jt}from"./chunk-QMQTSFHS.js";import"./chunk-FK6H3RFT.js";import{a as lt}from"./chunk-SSM3X36A.js";import{a as xt,b as Ct,c as vt,d as St,e as Mt,f as yt,g as Pt,h as wt,i as It,j as Ot,k as Et,l as Dt}from"./chunk-3XHLV4H2.js";import{ea as ft}from"./chunk-JMO4GQE3.js";import{c as st,k as z}from"./chunk-7UPJZXFQ.js";import{$ as g,$b as D,Ab as O,Bb as E,Db as S,Gb as m,Gc as ot,Hc as B,Ib as u,Ic as at,Kc as V,Lb as K,Lc as rt,Nb as X,Nc as F,Ob as Z,Pa as R,Pb as tt,Ta as s,Tb as o,Ua as y,Ub as b,Vb as d,Xb as P,Yb as M,Zb as w,_b as et,ac as nt,bc as it,da as I,dc as C,fc as v,la as _,ma as f,mb as h,ob as p,vb as J,wb as Y,xb as i,yb as n,zb as x}from"./chunk-2KSHIZ5A.js";import{e as Ut}from"./chunk-EQDQRRRY.js";var qt=(r,e)=>e.name,Lt=r=>({"modal-open":r});function Qt(r,e){if(r&1){let t=S();i(0,"button",11),m("click",function(){let l=_(t).$implicit,c=u();return f(c.selectCategory(l.id))}),o(1),n()}if(r&2){let t=e.$implicit;s(),b(t.name)}}function zt(r,e){if(r&1){let t=S();i(0,"div",12)(1,"div",13),x(2,"img",14),n(),i(3,"h2",15),o(4),n(),i(5,"p",16),o(6,"Disponible: "),i(7,"span"),o(8),n()(),i(9,"p",17),o(10,"C\xF3digo: "),i(11,"span"),o(12),n()(),i(13,"p",17),o(14,"Clave: "),i(15,"span"),o(16),n()(),i(17,"p",18),o(18),n(),i(19,"button",19),m("click",function(){let l=_(t).$implicit,c=u();return f(c.mostrarModal(l))}),o(20,"Agregar Producto"),n()()}if(r&2){let t=e.$implicit;s(2),K("alt",t.productName),p("src",t.img,R),s(2),b(t.productName),s(4),b(t.quantityInStock<0?0:t.quantityInStock),s(4),b(t.code),s(4),b(t.key),s(2),d("Q",t.salePrice,"")}}function Wt(r,e){if(r&1){let t=S();i(0,"div",20)(1,"div",21)(2,"h2"),o(3,"Producto sin stock"),n(),i(4,"p"),o(5),n(),i(6,"button",22),m("click",function(){_(t);let l=u();return f(l.cerrarModalSinStock())}),o(7,"Cerrar"),n()()()}if(r&2){let t=u();s(5),d("El producto ",t.productName," no est\xE1 disponible actualmente.")}}function $t(r,e){if(r&1){let t=S();i(0,"div",32)(1,"span"),o(2),n(),i(3,"div",33)(4,"button",34),m("click",function(){let l=_(t).$implicit,c=u(2);return f(c.decreaseQuantity(l))}),o(5,"-"),n(),i(6,"input",35),w("ngModelChange",function(l){let c=_(t).$implicit;return M(c.quantity,l)||(c.quantity=l),f(l)}),n(),i(7,"button",34),m("click",function(){let l=_(t).$implicit,c=u(2);return f(c.increaseQuantity(l))}),o(8,"+"),n()(),i(9,"input",36),w("ngModelChange",function(l){let c=_(t).$implicit;return M(c.discount,l)||(c.discount=l),f(l)}),n(),i(10,"span"),o(11),n(),i(12,"span"),o(13),n()()}if(r&2){let t=e.$implicit;s(2),b(t.name),s(4),P("ngModel",t.quantity),s(3),P("ngModel",t.discount),s(2),d("Q",t.unit_price*t.quantity,""),s(2),d("Q",t.unit_price*t.quantity-t.discount,"")}}function Gt(r,e){if(r&1){let t=S();i(0,"div",23)(1,"div",24)(2,"h2"),o(3,"Lista de productos"),n(),i(4,"div",25)(5,"div",26)(6,"span"),o(7,"Producto"),n(),i(8,"span"),o(9,"Cantidad"),n(),i(10,"span"),o(11,"Desc"),n(),i(12,"span"),o(13,"SubTotal"),n(),i(14,"span"),o(15,"Total"),n()(),h(16,$t,14,5,"div",27),i(17,"div",28)(18,"div")(19,"span"),o(20,"SubTotal"),n(),i(21,"span"),o(22),n()(),i(23,"div")(24,"span"),o(25,"Total"),n(),i(26,"span"),o(27),n()()(),i(28,"div",29)(29,"button",30),m("click",function(){_(t);let l=u();return f(l.close())}),o(30,"Cancelar Venta"),n(),i(31,"button",31),m("click",function(){_(t);let l=u();return f(l.confirmarVenta())}),o(32,"Confirmar venta"),n()()()()()}if(r&2){let t=u();s(16),p("ngForOf",t.selectedProducts),s(6),d("Q",t.calcularSubTotal(),""),s(5),d("Q",t.calcularTotal(),"")}}function Jt(r,e){if(r&1){let t=S();i(0,"div",37)(1,"div",38)(2,"h2"),o(3,"Detalles de la Venta"),n(),i(4,"div",39)(5,"p")(6,"strong"),o(7,"ID de Transacci\xF3n:"),n(),o(8),n(),i(9,"p")(10,"strong"),o(11,"Total de la Venta:"),n(),o(12),n()(),i(13,"div",40)(14,"div",41)(15,"span"),o(16,"SubTotal"),n(),i(17,"span"),o(18),n()(),i(19,"div",42)(20,"span"),o(21,"Total"),n(),i(22,"span"),o(23),n()()(),i(24,"div",43)(25,"div",44)(26,"label",45),o(27,"Monto recibido "),n(),i(28,"input",46),w("ngModelChange",function(l){_(t);let c=u();return M(c.montoRecibido,l)||(c.montoRecibido=l),f(l)}),m("ngModelChange",function(){_(t);let l=u();return f(l.calcularCambio())}),n()(),i(29,"div",47)(30,"label"),o(31,"Cambio "),n(),i(32,"span"),o(33),n()()(),i(34,"button",31),m("click",function(){_(t);let l=u();return f(l.confirmar())}),o(35,"Confirmar"),n()()()}if(r&2){let t=u();s(8),d(" ",t.transactionId,""),s(4),d(" Q",t.transactionTotal,""),s(6),d("Q",t.calcularSubTotal(),""),s(5),d("Q",t.calcularT(),""),s(5),P("ngModel",t.montoRecibido),s(5),d("Q",t.cambio,"")}}var N=class r{searchMessage="Buscar Producto";searchInput=null;isModalVisible=!1;_BaseApi=g(j);aItemsCategory;productos=[];selectedProducts=[];_sSweetAlet=g(k);isModalSinStockVisible=!1;isProductListModalVisible=!1;isPaymentModalVisible=!1;transactionId=null;transactionTotal=null;montoRecibido=0;cambio=0;total=0;productName="";mostrarModalConIdYTotal(e,t){this.transactionId=e,this.transactionTotal=t,this.isModalVisible=!0}calcularCambio(){this.cambio=this.montoRecibido-this.calcularT()}ngOnInit(){this._BaseApi.getItems("category").subscribe(e=>{e.isSuccess&&(this.aItemsCategory=e.value)}),this.selectCategory("all")}selectCategory(e){this._sSweetAlet.showLoading(),this._BaseApi.getItemsById("inventory/category",e).subscribe(t=>{t.isSuccess?(this.productos=t.value,this._sSweetAlet.closeLoading()):this._sSweetAlet.showError("Error")})}mostrarModal(e){if(e.quantityInStock<=0){this.productName=e.productName,this.isModalSinStockVisible=!0;return}let t={iD_product:e.productId,unit_price:e.salePrice||0,discount:0,quantity:1,total_item:e.salePrice||0,name:this.obtenerNombreProducto(e.id)};this.selectedProducts.push(t),this.isModalVisible=!0}mostrarModalSinStock(){this.isModalSinStockVisible=!0}cerrarModalSinStock(){this.isModalSinStockVisible=!1}obtenerNombreProducto(e){let t=this.productos.find(a=>a.id===e);return t?t.productName:"Producto no encontrado"}calcularSubTotal(){return this.selectedProducts.reduce((e,t)=>e+t.unit_price*t.quantity,0)}calcularTotal(){return this.selectedProducts&&this.selectedProducts.length>0?this.total=this.selectedProducts.reduce((e,t)=>{let a=t.unit_price*t.quantity,l=t.discount||0;return e+(a-l)},0):this.total=0,this.total}calcularT(){return this.transactionTotal??0}close(){this.isModalVisible=!1,this.selectedProducts=[]}confirmarVenta(){this._sSweetAlet.showLoading(),this._BaseApi.addItem("sale",this.selectedProducts).subscribe(e=>{e.isSuccess?(this._sSweetAlet.closeLoading(),this.transactionId=e.value.id,this.transactionTotal=e.value.total,this.close(),this.isPaymentModalVisible=!0):this._sSweetAlet.showError(e.error||"Error al registrar la venta")})}confirmar(){if(this._sSweetAlet.showLoading(),this.transactionTotal!==null&&this.montoRecibido>0){this.cambio=this.montoRecibido-this.transactionTotal;let e={amount:this.transactionTotal,saleId:this.transactionId,receiveAmount:this.montoRecibido,returnedAmount:this.cambio};this._BaseApi.addItem("cashFlow",e).subscribe(t=>{t.isSuccess?(this._sSweetAlet.showSuccess("venta realizado con exito"),this.selectCategory("all"),this.montoRecibido=0,this.transactionTotal=0):(this.montoRecibido=0,this.transactionTotal=0,this._sSweetAlet.showError(t.error||"Error al registrar la venta"))})}else this._sSweetAlet.showError("Error, el total o la cantidad no son validos");this.isPaymentModalVisible=!1}increaseQuantity(e){e.quantity+=1,e.total_item=e.unit_price*e.quantity-e.discount}decreaseQuantity(e){e.quantity>1&&(e.quantity-=1,e.total_item=e.unit_price*e.quantity-e.discount)}filtrarProductos(){}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=I({type:r,selectors:[["app-ventas"]],standalone:!0,features:[D],decls:13,vars:9,consts:[[1,"parent-container"],[1,"category-container"],[1,"category-button","active",3,"click"],[1,"category-button"],[3,"searchInputChange","ngModelChange","searchMessage","searchInput"],[1,"split-screen",3,"ngClass"],[1,"product-container"],["class","product-card",4,"ngFor","ngForOf"],["class","sin-stock-modal",4,"ngIf"],["class","product-list-detail-modal",4,"ngIf"],["class","payment-modal",4,"ngIf"],[1,"category-button",3,"click"],[1,"product-card"],[1,"wrapperImg"],[1,"imagenProducto",3,"src","alt"],[1,"Titulo"],[1,"Disponible"],[1,"Codigo"],[1,"Precio"],[1,"agregar-producto",3,"click"],[1,"sin-stock-modal"],[1,"sin-stock-content"],[1,"close-btn",3,"click"],[1,"product-list-detail-modal"],[1,"modal-content"],[1,"product-table"],[1,"table-header"],["class","table-row",4,"ngFor","ngForOf"],[1,"totals"],[1,"action-buttons"],[1,"cancel-btn",3,"click"],[1,"confirm-btn",3,"click"],[1,"table-row"],[1,"quantity-controls"],[3,"click"],["type","number","min","0",1,"quantity-input",3,"ngModelChange","ngModel"],["type","number","min","0",1,"desc-input",3,"ngModelChange","ngModel"],[1,"payment-modal"],[1,"payment-modal-content"],[1,"transaction-info"],[1,"payment-details"],[1,"subtotal-row"],[1,"total-row"],[1,"payment-inputs"],[1,"input-row"],["for","montoRecibido"],["type","number","id","montoRecibido","min","0",1,"input-monto",3,"ngModelChange","ngModel"],[1,"change-row"]],template:function(t,a){t&1&&(i(0,"div",0)(1,"div",1)(2,"button",2),m("click",function(){return a.selectCategory("all")}),o(3,"Todos"),n(),J(4,Qt,2,1,"button",3,qt),i(6,"app-input-search",4),w("searchInputChange",function(c){return M(a.searchInput,c)||(a.searchInput=c),c}),m("ngModelChange",function(){return a.filtrarProductos()}),n()(),i(7,"div",5)(8,"div",6),h(9,zt,21,7,"div",7),n(),h(10,Wt,8,1,"div",8)(11,Gt,33,3,"div",9)(12,Jt,36,6,"div",10),n()()),t&2&&(s(4),Y(a.aItemsCategory),s(2),p("searchMessage",a.searchMessage),P("searchInput",a.searchInput),s(),p("ngClass",it(7,Lt,a.isModalVisible)),s(2),p("ngForOf",a.productos),s(),p("ngIf",a.isModalSinStockVisible),s(),p("ngIf",a.isModalVisible),s(),p("ngIf",a.isPaymentModalVisible))},dependencies:[F,ot,B,at,U,gt,ct,mt,dt,ut,pt],styles:['@charset "UTF-8";.split-screen[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.product-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-top:50px;transition:all .3s ease}.split-screen.modal-open[_ngcontent-%COMP%]   .product-container[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}.product-card[_ngcontent-%COMP%]{flex:0 0 calc(25% - 20px);background-color:var(--white-color);border:1px solid var(--white-color);box-shadow:0 2px 8px #0000001a;display:flex;flex-direction:column;align-items:flex-start;padding:20px}.wrapperImg[_ngcontent-%COMP%]{display:flex;justify-content:center;width:100%}.imagenProducto[_ngcontent-%COMP%]{width:240px;height:150px;object-fit:cover}.Titulo[_ngcontent-%COMP%]{font-size:1.5rem}.Precio[_ngcontent-%COMP%], .Disponible[_ngcontent-%COMP%], .Codigo[_ngcontent-%COMP%]{width:100%;text-align:left;color:#196890;margin:-6px 0 0}.agregar-producto[_ngcontent-%COMP%]{margin-top:10%;padding:15px;background-color:#196890;color:#fff;border:none;border-radius:5px;cursor:pointer;width:100%;transition:background-color .3s}.agregar-producto[_ngcontent-%COMP%]:hover{background-color:#18a9e3}.product-list-detail-modal[_ngcontent-%COMP%]{right:0;top:0;height:auto;width:45%;padding:20px;box-shadow:-4px 0 8px #12060633;display:flex;flex-direction:column}.modal-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background-color:#00000080;z-index:999}.product-table[_ngcontent-%COMP%]{background-color:#f3f4f6;padding:10px;border-radius:10px;flex-grow:1;overflow-y:auto;height:auto}.table-header[_ngcontent-%COMP%], .table-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:2fr 1fr 1fr 1fr 1fr;align-items:center;padding:10px 0;font-weight:700}span[_ngcontent-%COMP%], .quantity-controls[_ngcontent-%COMP%], .desc-input[_ngcontent-%COMP%]{text-align:center}.quantity-controls[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.quantity-controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:35px;height:35px;font-size:1em;background-color:#3b82f6;color:#fff;border:none;border-radius:5px;margin:0 5px;cursor:pointer}.quantity-controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#2563eb}.desc-input[_ngcontent-%COMP%]{width:65px;height:35px;text-align:center}.quantity-controls[_ngcontent-%COMP%]   input[type=number][_ngcontent-%COMP%]{width:350%;padding:5px;border:1px solid #ccc;border-radius:4px;box-shadow:0 1px 2px #0000001a}.action-buttons[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-top:auto;padding-top:20px}.cancel-btn[_ngcontent-%COMP%]{background-color:#ef4444;color:#fff;padding:10px 20px;border:none;border-radius:5px;cursor:pointer}.confirm-btn[_ngcontent-%COMP%]{background-color:#3b82f6;color:#fff;padding:10px 20px;border:none;border-radius:5px;cursor:pointer}.cancel-btn[_ngcontent-%COMP%]{background-color:#ef4444;color:#fff}.confirm-btn[_ngcontent-%COMP%]{background-color:#3b82f6;color:#fff}.split-screen.modal-open[_ngcontent-%COMP%]   .product-container[_ngcontent-%COMP%]{flex:40%}.parent-container[_ngcontent-%COMP%]{margin:0;width:100%}.category-container[_ngcontent-%COMP%]{display:flex;align-items:center;padding:1rem;background-color:#fffffffe;position:sticky;top:10;width:100%;margin-top:-30px}.category-button[_ngcontent-%COMP%]{background-color:#e6e6e6;border:none;padding:.5rem 1rem;border-radius:12px;cursor:pointer;margin-right:10px;font-weight:700}.category-button.active[_ngcontent-%COMP%]{background-color:#2c3e50;color:#fff}.content[_ngcontent-%COMP%]{padding:1rem;height:2000px;background-color:#cf4d4d}.category-button[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:400;color:#666;margin-left:4px}.search-bar[_ngcontent-%COMP%]{display:flex;align-items:center;margin-left:auto;background-color:#fff;border:1px solid #ddd;border-radius:20px;padding:.5rem}.search-bar[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]{border:none;outline:none;padding:.5rem;border-radius:20px;width:150px}.search-button[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;padding:.5rem}.payment-modal[_ngcontent-%COMP%]{position:fixed;inset:0;background-color:#00000080;display:flex;justify-content:flex-end;align-items:center;z-index:999}.payment-modal-content[_ngcontent-%COMP%]{background-color:#fff;padding:68px;border-radius:10px;box-shadow:0 4px 20px #0000001a;width:600px;height:100%;max-width:90%;margin-right:0}.transaction-info[_ngcontent-%COMP%], .payment-details[_ngcontent-%COMP%]{margin-bottom:20px}.subtotal-row[_ngcontent-%COMP%], .total-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:5px 0}.payment-inputs[_ngcontent-%COMP%]{margin-bottom:20px}.confirm-btn[_ngcontent-%COMP%], .close-btn[_ngcontent-%COMP%]{background-color:#3b82f6;color:#fff;padding:10px 20px;border:none;border-radius:5px;cursor:pointer;margin-right:10px}.close-btn[_ngcontent-%COMP%]{background-color:#ef4444}.confirm-btn[_ngcontent-%COMP%]:hover, .close-btn[_ngcontent-%COMP%]:hover{opacity:.8}.input-monto[_ngcontent-%COMP%]{padding:10px;border:2px solid #e68925;border-radius:5px;box-shadow:0 2px 4px #0000001a;font-size:16px;transition:border-color .3s ease,box-shadow .3s ease}.input-monto[_ngcontent-%COMP%]:focus{border-color:#2563eb;box-shadow:0 0 5px #2663eb80;outline:none}.input-monto[_ngcontent-%COMP%]::placeholder{color:#aaa}.input-monto[_ngcontent-%COMP%]::-webkit-inner-spin-button, .input-monto[_ngcontent-%COMP%]::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}.sin-stock-modal[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#00000080;display:flex;justify-content:center;align-items:center}.sin-stock-content[_ngcontent-%COMP%]{background:#fff;padding:20px;border-radius:8px;text-align:center;box-shadow:0 4px 10px #0003}.close-btn[_ngcontent-%COMP%]{padding:10px 20px;border:none;border-radius:5px;font-size:16px;cursor:pointer;background:linear-gradient(45deg,#42a5f5,#1e88e5);color:#fff;transition:background .3s ease,transform .3s ease;margin-top:15px}.close-btn[_ngcontent-%COMP%]:hover{background:linear-gradient(45deg,#1e88e5,#1565c0);transform:scale(1.05)}']})};var Bt=Ut(jt());function Yt(r,e){if(r&1&&(i(0,"div",13)(1,"span"),o(2),n(),i(3,"span"),o(4),n(),i(5,"span"),o(6),C(7,"number"),n(),i(8,"span"),o(9),C(10,"number"),n(),i(11,"span"),o(12),C(13,"number"),n()()),r&2){let t=e.$implicit;s(2),b(t.nameProduct),s(2),b(t.quantity),s(2),d("Q. ",v(7,5,t.unit_price,"1.2-2"),""),s(3),d("Q. ",v(10,8,t.discount,"1.2-2"),""),s(3),d("Q. ",v(13,11,t.unit_price*t.quantity-t.discount*t.quantity,"1.2-2"),"")}}var q=class r{constructor(e,t,a){this.data=e;this.http=t;this.enterpriseService=a;console.log("Data de Constructor: ",e)}aSaleDetail;aUsers=[];_sAuth=g(T);_sSweetAlert=g(k);enterpriseInfor;datePipe=g(V);logocondor="/img/logo.png";apiUrl="https://localhost:7059/api/Enterprise/detail/";ngOnInit(){this._sSweetAlert.showLoading(),this._sAuth.getUsers().subscribe(e=>{e.isSuccess?(this.aUsers=e.value??[],this._sSweetAlert.closeLoading()):this._sSweetAlert.showError("Hubo un error")}),this.aSaleDetail=this.data.payload,this.enterpriseService.getEnterpriseById(1).subscribe(e=>{e.isSuccess?this.enterpriseInfor=e.value:console.error("Error al obtener datos de la empresa:",e.error)})}getEnterpriseById(e){return this.http.get(`${this.apiUrl}${e}`)}getNameUser(e){let t=this.aUsers.find(a=>a.id===e);return t?`${t.firstname.toUpperCase()} ${t.lastname.toUpperCase()}`:"Desconocido"}getSubtotal(){return this.aSaleDetail.products.reduce((e,t)=>e+t.unit_price*t.quantity,0)}getDescuento(){return this.aSaleDetail.products.reduce((e,t)=>e+t.discount*t.quantity,0)}printReceipt(){let e=document.getElementById("receiptContent");(0,Bt.default)(e).then(t=>{let a=new kt("p","mm","a4"),l=t.toDataURL("image/png"),c=190,G=a.internal.pageSize.height,A=t.height*c/t.width,H=A,Q=0;for(a.addImage(l,"PNG",10,Q,c,A),H-=G;H>=0;)Q=H-A,a.addPage(),a.addImage(l,"PNG",10,Q,c,A),H-=G;let Ft=this.datePipe.transform(this.aSaleDetail.saleDate,"dd-MM-yyyy_HH-mm")||"fecha-hora";a.save(`recibo-venta-${Ft}.pdf`)})}static \u0275fac=function(t){return new(t||r)(y(ht),y(st),y(At))};static \u0275cmp=I({type:r,selectors:[["app-historial-detail-popup"]],standalone:!0,features:[et([V]),D],decls:66,vars:23,consts:[["id","receiptContent",1,"sale-info"],[1,"head"],[1,"info-enterprise"],["alt","Logo",1,"logo",3,"src"],[1,"receipt-title"],[1,"header"],[1,"product-table-container"],[1,"product-table"],[1,"table-header"],["class","table-row",4,"ngFor","ngForOf"],[1,"totals"],[1,"button-container"],["mat-raised-button","",1,"custom-button",3,"click"],[1,"table-row"]],template:function(t,a){t&1&&(i(0,"div",0)(1,"div",1)(2,"section",2),x(3,"img",3),i(4,"p")(5,"strong"),o(6),n()()(),i(7,"h4",4),o(8,"Recibo de Venta"),n()(),i(9,"div",5)(10,"p")(11,"strong"),o(12,"Tel\xE9fono:"),n(),o(13),n(),i(14,"p")(15,"strong"),o(16,"E-mail:"),n(),o(17),n(),i(18,"p")(19,"strong"),o(20,"Direcci\xF3n:"),n(),o(21),n()(),x(22,"hr"),i(23,"p")(24,"strong"),o(25,"Vendedor:"),n(),o(26),n(),i(27,"p")(28,"strong"),o(29,"Fecha de venta:"),n(),o(30),C(31,"date"),n(),i(32,"div",6)(33,"div",7)(34,"div",8)(35,"span"),o(36,"Producto"),n(),i(37,"span"),o(38,"Cantidad"),n(),i(39,"span"),o(40,"Precio Unitario"),n(),i(41,"span"),o(42,"Descuento"),n(),i(43,"span"),o(44,"Total"),n()(),h(45,Yt,14,14,"div",9),n()(),i(46,"div",10)(47,"div")(48,"strong"),o(49,"SubTotal:"),n(),o(50),C(51,"number"),n(),i(52,"div")(53,"strong"),o(54,"Descuento:"),n(),o(55),C(56,"number"),n(),x(57,"hr"),i(58,"div")(59,"strong"),o(60,"TOTAL:"),n(),o(61),C(62,"number"),n()()(),i(63,"div",11)(64,"button",12),m("click",function(){return a.printReceipt()}),o(65,"Imprimir recibo"),n()()),t&2&&(s(3),p("src",a.logocondor,R),s(3),b(a.enterpriseInfor==null?null:a.enterpriseInfor.name),s(7),d(" ",a.enterpriseInfor==null?null:a.enterpriseInfor.phoneNumber,""),s(4),d(" ",a.enterpriseInfor==null?null:a.enterpriseInfor.email,""),s(4),d(" ",a.enterpriseInfor==null?null:a.enterpriseInfor.address,""),s(5),d(" ",a.getNameUser(a.aSaleDetail.iD_User),""),s(4),d(" ",v(31,11,a.aSaleDetail.saleDate,"short"),""),s(15),p("ngForOf",a.aSaleDetail.products),s(5),d(" Q",v(51,14,a.getSubtotal(),"1.2-2"),""),s(5),d(" Q",v(56,17,a.getDescuento(),"1.2-2"),""),s(6),d(" Q",v(62,20,a.aSaleDetail.total,"1.2-2"),""))},dependencies:[V,F,B,rt],styles:["div.sale-info[_ngcontent-%COMP%]{font-family:PoppinsRegular;padding-top:30px;padding-bottom:25px}.head[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;font-family:PoppinsBold}.head[_ngcontent-%COMP%]   .info-enterprise[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;text-align:center}.head[_ngcontent-%COMP%]   .info-enterprise[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{max-width:80px}.header[_ngcontent-%COMP%]{margin:10px 0 10px 5%}.header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:5px 0}.header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-family:PoppinsBold}.product-table-container[_ngcontent-%COMP%]{display:flex;justify-content:center;width:100%;margin-top:20px}.product-table[_ngcontent-%COMP%]{width:95%;border-collapse:collapse}.table-header[_ngcontent-%COMP%], .table-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:8px;border-bottom:1px solid var(--txt-color)}.table-header[_ngcontent-%COMP%]{background-color:var(--txt-second-color);font-weight:700}.table-row[_ngcontent-%COMP%]{background-color:var(--blue-pale-color)}.table-row[_ngcontent-%COMP%]:nth-child(2n){background-color:var(--blue-pale-color)}.table-header[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .table-row[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{flex:1;text-align:center}.totals[_ngcontent-%COMP%]{text-align:center;margin-top:10px;font-size:1.1em}.totals[_ngcontent-%COMP%]   div[_ngcontent-%COMP%], hr[_ngcontent-%COMP%]{margin-top:.3em}.totals[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:var(--black-txt-color)}.totals[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:last-child   strong[_ngcontent-%COMP%]{color:var(--bg-red-color)}.button-container[_ngcontent-%COMP%]{display:flex;justify-content:center;margin-top:10px}.custom-button[_ngcontent-%COMP%]{background-color:var(--txt-blue-color);color:var(--white-color)!important;border-radius:5px;padding:5px;font-size:1.3em}.custom-button[_ngcontent-%COMP%]:hover{background-color:var(--txt-color);color:var(--white-color)!important}h4[_ngcontent-%COMP%]{flex:1;text-align:center;font-size:2em;color:var(--primary-color);font-family:PoppinsBold}p[_ngcontent-%COMP%]{margin-left:5%;margin-top:.5em;margin-bottom:.5em}p[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-family:PoppinsBold}"]})};var Kt=()=>[5,10,20];function Xt(r,e){r&1&&(i(0,"th",21),o(1,"Fecha de venta"),n())}function Zt(r,e){if(r&1&&(i(0,"td",22),o(1),C(2,"date"),n()),r&2){let t=e.$implicit;s(),d(" ",v(2,1,t.saleDate,"short")," ")}}function te(r,e){r&1&&(i(0,"th",21),o(1,"Usuario"),n())}function ee(r,e){if(r&1&&(i(0,"td",22),o(1),n()),r&2){let t=e.$implicit,a=u();s(),d(" ",a.getNameById(t.iD_User)," ")}}function ne(r,e){r&1&&(i(0,"th",21),o(1,"Total de ventas"),n())}function ie(r,e){if(r&1&&(i(0,"td",22),o(1),n()),r&2){let t=e.$implicit;s(),d(" ",t.total," ")}}function oe(r,e){r&1&&(i(0,"th",21),o(1,"Cantidad de producto"),n())}function ae(r,e){if(r&1&&(i(0,"td",22),o(1),n()),r&2){let t=e.$implicit;s(),d(" ",t.productsTotal," ")}}function re(r,e){r&1&&(i(0,"th",21),o(1,"Acciones"),n())}function se(r,e){if(r&1){let t=S();i(0,"td",23)(1,"div",24)(2,"button",25),m("click",function(){let l=_(t).$implicit,c=u();return f(c.onViewDetails(l.id))}),i(3,"mat-icon"),o(4,"visibility"),n()()()()}}function le(r,e){r&1&&x(0,"tr",26)}function ce(r,e){r&1&&x(0,"tr",27)}var L=class r{constructor(e,t,a){this._matDialog=e;this.authService=t;this.sTitle=a;this.sTitle.setTitle("Ventas / Historial")}searchMessage="Buscar ventas";searchInput=null;selectedStartDate;selectedEndDate;_BaseApi=g(j);_AuthS=g(T);_SweetAlerts=g(k);totalItems=0;paginator;dataSource=new Dt;paginatorSubscription;displayedColumns=["total","iD_User","saleDate","productsTotal","acciones"];aItemsUser=[];ngOnInit(){this._SweetAlerts.showLoading(),this._AuthS.getUsers().subscribe(e=>{this.aItemsUser=e.value??[],this._SweetAlerts.closeLoading()})}ngAfterViewInit(){this.paginatorSubscription=this.paginator.page.subscribe(()=>this.loadItems()),this.loadItems(),this.paginator.page.subscribe(()=>this.loadItems()),this.loadItems()}onSearch(e){console.log(e)}onViewDetails(e){this._SweetAlerts.showLoading(),this._BaseApi.getDetail("sale",e).subscribe(t=>{t.isSuccess&&(this._SweetAlerts.closeLoading(),this._matDialog.open(q,{width:"550px",height:"100vh",maxHeight:"100vh",position:{right:"0"},panelClass:"dialog-detail",data:{payload:t.value}}))})}filterItems(){this._BaseApi.filter("sale",this.searchInput,this.selectedStartDate,this.selectedEndDate).subscribe(e=>{this.dataSource.data=e.value})}clearFilters(){this.searchInput=null,this.selectedEndDate=null,this.selectedStartDate=null,this.paginator.pageIndex=0,this.loadItems()}loadItems(){this._SweetAlerts.showLoading();let e=this.paginator.pageIndex,t=this.paginator.pageSize;this._BaseApi.getItemsPagination("sale",e+1,t).subscribe(a=>{this._SweetAlerts.closeLoading(),this.dataSource.data=a.items,this.totalItems=a.pagination.TotalItemCount,this.paginator.pageIndex=a.pagination.CurrentPage-1,this.paginator.length=this.totalItems})}getNameById(e){if(this.aItemsUser.length>0){let t=this.aItemsUser.find(a=>a.id==e);return t?t.username:e}else return e}static \u0275fac=function(t){return new(t||r)(y(bt),y(T),y(ft))};static \u0275cmp=I({type:r,selectors:[["app-historial-ventas"]],viewQuery:function(t,a){if(t&1&&X($,5),t&2){let l;Z(l=tt())&&(a.paginator=l.first)}},standalone:!0,features:[D],decls:31,vars:10,consts:[[1,"container"],[1,"main-content"],[1,"flex","flex-wrap","justify-end","items-end","gap-4","mb-4"],[3,"startDateChange","endDateChange","startDate","endDate"],[3,"searchInputChange","searchMessage","searchInput"],["type","button",1,"bg-blue-600","hover:bg-blue-700","text-white","font-medium","py-2","px-4","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-300",3,"click"],["type","button",1,"bg-gray-500","hover:bg-gray-600","text-white","font-medium","py-2","px-4","rounded-md","focus:outline-none","focus:ring-2","focus:ring-gray-300","ml-2",3,"click"],[1,"example-container","mat-elevation-z8"],[1,"example-table-container"],["mat-table","","matSort","","matSortActive","created","matSortDisableClear","","matSortDirection","desc",1,"example-table",3,"dataSource"],["matColumnDef","saleDate"],["class","itemHeader","mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","iD_User"],["matColumnDef","total"],["matColumnDef","productsTotal"],["matColumnDef","acciones"],["mat-cell","","class","actions-cell",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","",3,"length","pageSizeOptions"],["mat-header-cell","",1,"itemHeader"],["mat-cell",""],["mat-cell","",1,"actions-cell"],[1,"actions-container"],["mat-icon-button","",1,"btnVer",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(t,a){t&1&&(i(0,"div",0)(1,"main",1)(2,"div",2)(3,"app-date-start-end",3),w("startDateChange",function(c){return M(a.selectedStartDate,c)||(a.selectedStartDate=c),c})("endDateChange",function(c){return M(a.selectedEndDate,c)||(a.selectedEndDate=c),c}),n(),i(4,"app-input-search",4),w("searchInputChange",function(c){return M(a.searchInput,c)||(a.searchInput=c),c}),n()(),i(5,"div",2)(6,"button",5),m("click",function(){return a.filterItems()}),o(7," Buscar "),n(),i(8,"button",6),m("click",function(){return a.clearFilters()}),o(9," Limpiar "),n()(),i(10,"div",7)(11,"div",8)(12,"table",9),O(13,10),h(14,Xt,2,0,"th",11)(15,Zt,3,4,"td",12),E(),O(16,13),h(17,te,2,0,"th",11)(18,ee,2,1,"td",12),E(),O(19,14),h(20,ne,2,0,"th",11)(21,ie,2,1,"td",12),E(),O(22,15),h(23,oe,2,0,"th",11)(24,ae,2,1,"td",12),E(),O(25,16),h(26,re,2,0,"th",11)(27,se,5,0,"td",17),E(),h(28,le,1,0,"tr",18)(29,ce,1,0,"tr",19),n(),x(30,"mat-paginator",20),n()()()()),t&2&&(s(3),P("startDate",a.selectedStartDate)("endDate",a.selectedEndDate),s(),p("searchMessage",a.searchMessage),P("searchInput",a.searchInput),s(8),p("dataSource",a.dataSource),s(16),p("matHeaderRowDef",a.displayedColumns),s(),p("matRowDefColumns",a.displayedColumns),s(),p("length",a.totalItems)("pageSizeOptions",nt(9,Kt)))},dependencies:[U,lt,Et,xt,vt,Pt,St,Ct,wt,Mt,yt,It,Ot,_t,Tt,$,Vt,V],styles:[".container[_ngcontent-%COMP%]{display:flex;width:100%;font-family:PoppinsSemiBold}.main-content[_ngcontent-%COMP%]{width:100%;flex-grow:1}.controls[_ngcontent-%COMP%]{display:flex;align-items:flex-end;justify-content:flex-end;gap:10px;margin-bottom:20px}.controls[_ngcontent-%COMP%]   .search-button[_ngcontent-%COMP%], .controls[_ngcontent-%COMP%]   .add-user-button[_ngcontent-%COMP%]{padding:8px 12px;border:none;color:var(--bg-color);cursor:pointer;border-radius:4px;transition:background .3s ease}.controls[_ngcontent-%COMP%]   .search-button[_ngcontent-%COMP%]:hover, .controls[_ngcontent-%COMP%]   .add-user-button[_ngcontent-%COMP%]:hover{background-color:var(--sky-color)}.controls[_ngcontent-%COMP%]   .date-input[_ngcontent-%COMP%]{border:1px solid orange;border-radius:5px;outline:none;padding:8px}.controls[_ngcontent-%COMP%]   .state-select[_ngcontent-%COMP%], .controls[_ngcontent-%COMP%]   .role-select[_ngcontent-%COMP%], .controls[_ngcontent-%COMP%]   .search-input[_ngcontent-%COMP%]{padding:8px;border:1px solid var(--bg-color);border-radius:4px}.controls[_ngcontent-%COMP%]   .add-user-button[_ngcontent-%COMP%]{background-color:var(--txt-orange-color);font-size:20px;padding:8px 16px}.example-loading-shade[_ngcontent-%COMP%]{position:absolute;inset:0 0 56px;background:#00000026;z-index:1;display:flex;align-items:center;justify-content:center}.example-rate-limit-reached[_ngcontent-%COMP%]{max-width:360px;text-align:center}.mat-column-number[_ngcontent-%COMP%], .mat-column-state[_ngcontent-%COMP%]{width:64px}.mat-column-created[_ngcontent-%COMP%]{width:124px}.list-inputs[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:flex-end;margin:0 0 20px;gap:10px}.custom-dialog-container[_ngcontent-%COMP%]{background-color:red!important;padding:30px;width:30px!important}"]})};var ln=[{path:"venta",component:N,canActivate:[()=>g(W).isTokenExpired()?(g(z).navigate(["/iniciarSesion"]),!1):!0]},{path:"historial",component:L,canActivate:[()=>g(W).isTokenExpired()?(g(z).navigate(["/iniciarSesion"]),!1):!0]}];export{ln as VENTA_ROUTES};
