import{a as kt}from"./chunk-SGWLUR2T.js";import{b as ft,c as bt,i as W,j as Vt}from"./chunk-OOAZRNMC.js";import{a as V,b as U}from"./chunk-IEQECBUB.js";import{d as gt}from"./chunk-CGZ4YKKZ.js";import"./chunk-436OHTVF.js";import"./chunk-AESYL7IM.js";import"./chunk-UZQ2FFVI.js";import{a as Tt}from"./chunk-FWAYOKEG.js";import{b as Dt}from"./chunk-LCRFK72W.js";import{a as z}from"./chunk-ZWHC7VKH.js";import{a as E}from"./chunk-ZDGXBWHY.js";import{d as st,g as ct,k as dt,m as pt,t as mt,w as ut}from"./chunk-AVVPDZJM.js";import{a as Ut}from"./chunk-QMQTSFHS.js";import"./chunk-FK6H3RFT.js";import{a as lt}from"./chunk-AUQWKMJ6.js";import{a as ht,b as xt,c as Ct,d as vt,e as St,f as Mt,g as Pt,h as yt,i as wt,j as It,k as Ot,l as Et}from"./chunk-JCID66WL.js";import{ea as _t}from"./chunk-JM4IHHD6.js";import{c as rt,k as Q}from"./chunk-MTNE5NEP.js";import{$b as tt,Ab as h,Bb as y,Cb as w,Eb as S,Hb as g,Hc as it,Ic as B,Jb as m,Jc as ot,Lc as O,Mb as Y,Mc as at,Ob as K,Oc as F,Pb as X,Qa as H,Qb as Z,Ua as l,Ub as o,Va as M,Vb as x,Wb as c,Yb as D,Zb as T,_b as k,aa as u,ac as I,bc as et,cc as nt,ea as P,ec as C,gc as v,ma as _,na as f,nb as b,pb as p,wb as G,xb as J,yb as i,zb as n}from"./chunk-X4DW4WN7.js";import{e as Ft}from"./chunk-EQDQRRRY.js";var Nt=(r,e)=>e.name,qt=r=>({"modal-open":r});function Lt(r,e){if(r&1){let t=S();i(0,"button",11),g("click",function(){let s=_(t).$implicit,d=m();return f(d.selectCategory(s.id))}),o(1),n()}if(r&2){let t=e.$implicit;l(),x(t.name)}}function Qt(r,e){if(r&1){let t=S();i(0,"div",12)(1,"div",13),h(2,"img",14),n(),i(3,"h2",15),o(4),n(),i(5,"p",16),o(6,"Disponible: "),i(7,"span"),o(8),n()(),i(9,"p",17),o(10,"C\xF3digo: "),i(11,"span"),o(12),n()(),i(13,"p",17),o(14,"Clave: "),i(15,"span"),o(16),n()(),i(17,"p",18),o(18),n(),i(19,"button",19),g("click",function(){let s=_(t).$implicit,d=m();return f(d.mostrarModal(s))}),o(20,"Agregar Producto"),n()()}if(r&2){let t=e.$implicit;l(2),Y("alt",t.productName),p("src",t.img,H),l(2),x(t.productName),l(4),x(t.quantityInStock<0?0:t.quantityInStock),l(4),x(t.code),l(4),x(t.key),l(2),c("Q",t.salePrice,"")}}function zt(r,e){if(r&1){let t=S();i(0,"div",20)(1,"div",21)(2,"h2"),o(3,"Producto sin stock"),n(),i(4,"p"),o(5),n(),i(6,"button",22),g("click",function(){_(t);let s=m();return f(s.cerrarModalSinStock())}),o(7,"Cerrar"),n()()()}if(r&2){let t=m();l(5),c("El producto ",t.productName," no est\xE1 disponible actualmente.")}}function Wt(r,e){if(r&1){let t=S();i(0,"div",32)(1,"span"),o(2),n(),i(3,"div",33)(4,"button",34),g("click",function(){let s=_(t).$implicit,d=m(2);return f(d.decreaseQuantity(s))}),o(5,"-"),n(),i(6,"input",35),k("ngModelChange",function(s){let d=_(t).$implicit;return T(d.quantity,s)||(d.quantity=s),f(s)}),n(),i(7,"button",34),g("click",function(){let s=_(t).$implicit,d=m(2);return f(d.increaseQuantity(s))}),o(8,"+"),n()(),i(9,"input",36),k("ngModelChange",function(s){let d=_(t).$implicit;return T(d.discount,s)||(d.discount=s),f(s)}),n(),i(10,"span"),o(11),n(),i(12,"span"),o(13),n()()}if(r&2){let t=e.$implicit;l(2),x(t.name),l(4),D("ngModel",t.quantity),l(3),D("ngModel",t.discount),l(2),c("Q",t.unit_price*t.quantity,""),l(2),c("Q",t.unit_price*t.quantity-t.discount,"")}}function $t(r,e){if(r&1){let t=S();i(0,"div",23)(1,"div",24)(2,"h2"),o(3,"Lista de productos"),n(),i(4,"div",25)(5,"div",26)(6,"span"),o(7,"Producto"),n(),i(8,"span"),o(9,"Cantidad"),n(),i(10,"span"),o(11,"Desc"),n(),i(12,"span"),o(13,"SubTotal"),n(),i(14,"span"),o(15,"Total"),n()(),b(16,Wt,14,5,"div",27),i(17,"div",28)(18,"div")(19,"span"),o(20,"SubTotal"),n(),i(21,"span"),o(22),n()(),i(23,"div")(24,"span"),o(25,"Total"),n(),i(26,"span"),o(27),n()()(),i(28,"div",29)(29,"button",30),g("click",function(){_(t);let s=m();return f(s.close())}),o(30,"Cancelar Venta"),n(),i(31,"button",31),g("click",function(){_(t);let s=m();return f(s.confirmarVenta())}),o(32,"Confirmar venta"),n()()()()()}if(r&2){let t=m();l(16),p("ngForOf",t.selectedProducts),l(6),c("Q",t.calcularSubTotal(),""),l(5),c("Q",t.calcularTotal(),"")}}function Gt(r,e){if(r&1){let t=S();i(0,"div",37)(1,"div",38)(2,"h2"),o(3,"Detalles de la Venta"),n(),i(4,"div",39)(5,"p")(6,"strong"),o(7,"ID de Transacci\xF3n:"),n(),o(8),n(),i(9,"p")(10,"strong"),o(11,"Total de la Venta:"),n(),o(12),n()(),i(13,"div",40)(14,"div",41)(15,"span"),o(16,"SubTotal"),n(),i(17,"span"),o(18),n()(),i(19,"div",42)(20,"span"),o(21,"Total"),n(),i(22,"span"),o(23),n()()(),i(24,"div",43)(25,"div",44)(26,"label",45),o(27,"Monto recibido "),n(),i(28,"input",46),k("ngModelChange",function(s){_(t);let d=m();return T(d.montoRecibido,s)||(d.montoRecibido=s),f(s)}),g("ngModelChange",function(){_(t);let s=m();return f(s.calcularCambio())}),n()(),i(29,"div",47)(30,"label"),o(31,"Cambio "),n(),i(32,"span"),o(33),n()()(),i(34,"button",31),g("click",function(){_(t);let s=m();return f(s.confirmar())}),o(35,"Confirmar"),n()()()}if(r&2){let t=m();l(8),c(" ",t.transactionId,""),l(4),c(" Q",t.transactionTotal,""),l(6),c("Q",t.calcularSubTotal(),""),l(5),c("Q",t.calcularT(),""),l(5),D("ngModel",t.montoRecibido),l(5),c("Q",t.cambio,"")}}var j=class r{searchMessage="Buscar Producto";searchInput=null;isModalVisible=!1;_BaseApi=u(U);aItemsCategory;productos=[];selectedProducts=[];_sSweetAlet=u(V);isModalSinStockVisible=!1;isProductListModalVisible=!1;isPaymentModalVisible=!1;transactionId=null;transactionTotal=null;montoRecibido=0;cambio=0;total=0;productName="";mostrarModalConIdYTotal(e,t){this.transactionId=e,this.transactionTotal=t,this.isModalVisible=!0}calcularCambio(){this.cambio=this.montoRecibido-this.calcularT()}ngOnInit(){this._BaseApi.getItems("category").subscribe(e=>{e.isSuccess&&(this.aItemsCategory=e.value)}),this.selectCategory("all")}selectCategory(e){this._sSweetAlet.showLoading(),this._BaseApi.getItemsById("inventory/category",e).subscribe(t=>{t.isSuccess?(this.productos=t.value,this._sSweetAlet.closeLoading()):this._sSweetAlet.showError("Error")})}mostrarModal(e){if(e.quantityInStock<=0){this.productName=e.productName,this.isModalSinStockVisible=!0;return}let t={iD_product:e.productId,unit_price:e.salePrice||0,discount:0,quantity:1,total_item:e.salePrice||0,name:this.obtenerNombreProducto(e.id)};this.selectedProducts.push(t),this.isModalVisible=!0}mostrarModalSinStock(){this.isModalSinStockVisible=!0}cerrarModalSinStock(){this.isModalSinStockVisible=!1}obtenerNombreProducto(e){let t=this.productos.find(a=>a.id===e);return t?t.productName:"Producto no encontrado"}calcularSubTotal(){return this.selectedProducts.reduce((e,t)=>e+t.unit_price*t.quantity,0)}calcularTotal(){return this.selectedProducts&&this.selectedProducts.length>0?this.total=this.selectedProducts.reduce((e,t)=>{let a=t.unit_price*t.quantity,s=t.discount||0;return e+(a-s)},0):this.total=0,this.total}calcularT(){return this.transactionTotal??0}close(){this.isModalVisible=!1,this.selectedProducts=[]}confirmarVenta(){this._sSweetAlet.showLoading(),this._BaseApi.addItem("sale",this.selectedProducts).subscribe(e=>{e.isSuccess?(this._sSweetAlet.closeLoading(),this.transactionId=e.value.id,this.transactionTotal=e.value.total,this.close(),this.isPaymentModalVisible=!0):this._sSweetAlet.showError(e.error||"Error al registrar la venta")})}confirmar(){if(this._sSweetAlet.showLoading(),this.transactionTotal!==null&&this.montoRecibido>0){this.cambio=this.montoRecibido-this.transactionTotal;let e={amount:this.transactionTotal,saleId:this.transactionId,receiveAmount:this.montoRecibido,returnedAmount:this.cambio};this._BaseApi.addItem("cashFlow",e).subscribe(t=>{t.isSuccess?(this._sSweetAlet.showSuccess("venta realizado con exito"),this.selectCategory("all"),this.montoRecibido=0,this.transactionTotal=0):(this.montoRecibido=0,this.transactionTotal=0,this._sSweetAlet.showError(t.error||"Error al registrar la venta"))})}else this._sSweetAlet.showError("Error, el total o la cantidad no son validos");this.isPaymentModalVisible=!1}increaseQuantity(e){e.quantity+=1,e.total_item=e.unit_price*e.quantity-e.discount}decreaseQuantity(e){e.quantity>1&&(e.quantity-=1,e.total_item=e.unit_price*e.quantity-e.discount)}filtrarProductos(){}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=P({type:r,selectors:[["app-ventas"]],standalone:!0,features:[I],decls:13,vars:9,consts:[[1,"parent-container"],[1,"category-container"],[1,"category-button","active",3,"click"],[1,"category-button"],[3,"searchInputChange","ngModelChange","searchMessage","searchInput"],[1,"split-screen",3,"ngClass"],[1,"product-container"],["class","product-card",4,"ngFor","ngForOf"],["class","sin-stock-modal",4,"ngIf"],["class","product-list-detail-modal",4,"ngIf"],["class","payment-modal",4,"ngIf"],[1,"category-button",3,"click"],[1,"product-card"],[1,"wrapperImg"],[1,"imagenProducto",3,"src","alt"],[1,"Titulo"],[1,"Disponible"],[1,"Codigo"],[1,"Precio"],[1,"agregar-producto",3,"click"],[1,"sin-stock-modal"],[1,"sin-stock-content"],[1,"close-btn",3,"click"],[1,"product-list-detail-modal"],[1,"modal-content"],[1,"product-table"],[1,"table-header"],["class","table-row",4,"ngFor","ngForOf"],[1,"totals"],[1,"action-buttons"],[1,"cancel-btn",3,"click"],[1,"confirm-btn",3,"click"],[1,"table-row"],[1,"quantity-controls"],[3,"click"],["type","number","min","0",1,"quantity-input",3,"ngModelChange","ngModel"],["type","number","min","0",1,"desc-input",3,"ngModelChange","ngModel"],[1,"payment-modal"],[1,"payment-modal-content"],[1,"transaction-info"],[1,"payment-details"],[1,"subtotal-row"],[1,"total-row"],[1,"payment-inputs"],[1,"input-row"],["for","montoRecibido"],["type","number","id","montoRecibido","min","0",1,"input-monto",3,"ngModelChange","ngModel"],[1,"change-row"]],template:function(t,a){t&1&&(i(0,"div",0)(1,"div",1)(2,"button",2),g("click",function(){return a.selectCategory("all")}),o(3,"Todos"),n(),G(4,Lt,2,1,"button",3,Nt),i(6,"app-input-search",4),k("searchInputChange",function(d){return T(a.searchInput,d)||(a.searchInput=d),d}),g("ngModelChange",function(){return a.filtrarProductos()}),n()(),i(7,"div",5)(8,"div",6),b(9,Qt,21,7,"div",7),n(),b(10,zt,8,1,"div",8)(11,$t,33,3,"div",9)(12,Gt,36,6,"div",10),n()()),t&2&&(l(4),J(a.aItemsCategory),l(2),p("searchMessage",a.searchMessage),D("searchInput",a.searchInput),l(),p("ngClass",nt(7,qt,a.isModalVisible)),l(2),p("ngForOf",a.productos),l(),p("ngIf",a.isModalSinStockVisible),l(),p("ngIf",a.isModalVisible),l(),p("ngIf",a.isPaymentModalVisible))},dependencies:[F,it,B,ot,kt,ut,st,pt,ct,mt,dt],styles:['@charset "UTF-8";.split-screen[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.product-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-top:50px;transition:all .3s ease}.split-screen.modal-open[_ngcontent-%COMP%]   .product-container[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}.product-card[_ngcontent-%COMP%]{flex:0 0 calc(25% - 20px);background-color:var(--white-color);border:1px solid var(--white-color);box-shadow:0 2px 8px #0000001a;display:flex;flex-direction:column;align-items:flex-start;padding:20px}.wrapperImg[_ngcontent-%COMP%]{display:flex;justify-content:center;width:100%}.imagenProducto[_ngcontent-%COMP%]{width:240px;height:150px;object-fit:cover}.Titulo[_ngcontent-%COMP%]{font-size:1.5rem}.Precio[_ngcontent-%COMP%], .Disponible[_ngcontent-%COMP%], .Codigo[_ngcontent-%COMP%]{width:100%;text-align:left;color:#196890;margin:-6px 0 0}.agregar-producto[_ngcontent-%COMP%]{margin-top:10%;padding:15px;background-color:#196890;color:#fff;border:none;border-radius:5px;cursor:pointer;width:100%;transition:background-color .3s}.agregar-producto[_ngcontent-%COMP%]:hover{background-color:#18a9e3}.product-list-detail-modal[_ngcontent-%COMP%]{right:0;top:0;height:auto;width:45%;padding:20px;box-shadow:-4px 0 8px #12060633;display:flex;flex-direction:column}.modal-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background-color:#00000080;z-index:999}.product-table[_ngcontent-%COMP%]{background-color:#f3f4f6;padding:10px;border-radius:10px;flex-grow:1;overflow-y:auto;height:auto}.table-header[_ngcontent-%COMP%], .table-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:2fr 1fr 1fr 1fr 1fr;align-items:center;padding:10px 0;font-weight:700}span[_ngcontent-%COMP%], .quantity-controls[_ngcontent-%COMP%], .desc-input[_ngcontent-%COMP%]{text-align:center}.quantity-controls[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.quantity-controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:35px;height:35px;font-size:1em;background-color:#3b82f6;color:#fff;border:none;border-radius:5px;margin:0 5px;cursor:pointer}.quantity-controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#2563eb}.desc-input[_ngcontent-%COMP%]{width:65px;height:35px;text-align:center}.quantity-controls[_ngcontent-%COMP%]   input[type=number][_ngcontent-%COMP%]{width:350%;padding:5px;border:1px solid #ccc;border-radius:4px;box-shadow:0 1px 2px #0000001a}.action-buttons[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-top:auto;padding-top:20px}.cancel-btn[_ngcontent-%COMP%]{background-color:#ef4444;color:#fff;padding:10px 20px;border:none;border-radius:5px;cursor:pointer}.confirm-btn[_ngcontent-%COMP%]{background-color:#3b82f6;color:#fff;padding:10px 20px;border:none;border-radius:5px;cursor:pointer}.cancel-btn[_ngcontent-%COMP%]{background-color:#ef4444;color:#fff}.confirm-btn[_ngcontent-%COMP%]{background-color:#3b82f6;color:#fff}.split-screen.modal-open[_ngcontent-%COMP%]   .product-container[_ngcontent-%COMP%]{flex:40%}.parent-container[_ngcontent-%COMP%]{margin:0;width:100%}.category-container[_ngcontent-%COMP%]{display:flex;align-items:center;padding:1rem;background-color:#fffffffe;position:sticky;top:10;width:100%;margin-top:-30px}.category-button[_ngcontent-%COMP%]{background-color:#e6e6e6;border:none;padding:.5rem 1rem;border-radius:12px;cursor:pointer;margin-right:10px;font-weight:700}.category-button.active[_ngcontent-%COMP%]{background-color:#2c3e50;color:#fff}.content[_ngcontent-%COMP%]{padding:1rem;height:2000px;background-color:#cf4d4d}.category-button[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:400;color:#666;margin-left:4px}.search-bar[_ngcontent-%COMP%]{display:flex;align-items:center;margin-left:auto;background-color:#fff;border:1px solid #ddd;border-radius:20px;padding:.5rem}.search-bar[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]{border:none;outline:none;padding:.5rem;border-radius:20px;width:150px}.search-button[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;padding:.5rem}.payment-modal[_ngcontent-%COMP%]{position:fixed;inset:0;background-color:#00000080;display:flex;justify-content:flex-end;align-items:center;z-index:999}.payment-modal-content[_ngcontent-%COMP%]{background-color:#fff;padding:68px;border-radius:10px;box-shadow:0 4px 20px #0000001a;width:600px;height:100%;max-width:90%;margin-right:0}.transaction-info[_ngcontent-%COMP%], .payment-details[_ngcontent-%COMP%]{margin-bottom:20px}.subtotal-row[_ngcontent-%COMP%], .total-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:5px 0}.payment-inputs[_ngcontent-%COMP%]{margin-bottom:20px}.confirm-btn[_ngcontent-%COMP%], .close-btn[_ngcontent-%COMP%]{background-color:#3b82f6;color:#fff;padding:10px 20px;border:none;border-radius:5px;cursor:pointer;margin-right:10px}.close-btn[_ngcontent-%COMP%]{background-color:#ef4444}.confirm-btn[_ngcontent-%COMP%]:hover, .close-btn[_ngcontent-%COMP%]:hover{opacity:.8}.input-monto[_ngcontent-%COMP%]{padding:10px;border:2px solid #e68925;border-radius:5px;box-shadow:0 2px 4px #0000001a;font-size:16px;transition:border-color .3s ease,box-shadow .3s ease}.input-monto[_ngcontent-%COMP%]:focus{border-color:#2563eb;box-shadow:0 0 5px #2663eb80;outline:none}.input-monto[_ngcontent-%COMP%]::placeholder{color:#aaa}.input-monto[_ngcontent-%COMP%]::-webkit-inner-spin-button, .input-monto[_ngcontent-%COMP%]::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}.sin-stock-modal[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#00000080;display:flex;justify-content:center;align-items:center}.sin-stock-content[_ngcontent-%COMP%]{background:#fff;padding:20px;border-radius:8px;text-align:center;box-shadow:0 4px 10px #0003}.close-btn[_ngcontent-%COMP%]{padding:10px 20px;border:none;border-radius:5px;font-size:16px;cursor:pointer;background:linear-gradient(45deg,#42a5f5,#1e88e5);color:#fff;transition:background .3s ease,transform .3s ease;margin-top:15px}.close-btn[_ngcontent-%COMP%]:hover{background:linear-gradient(45deg,#1e88e5,#1565c0);transform:scale(1.05)}']})};var Ht=Ft(Ut());function Jt(r,e){if(r&1&&(i(0,"div",13)(1,"span"),o(2),n(),i(3,"span"),o(4),n(),i(5,"span"),o(6),C(7,"number"),n(),i(8,"span"),o(9),C(10,"number"),n(),i(11,"span"),o(12),C(13,"number"),n()()),r&2){let t=e.$implicit;l(2),x(t.nameProduct),l(2),x(t.quantity),l(2),c("Q. ",v(7,5,t.unit_price,"1.2-2"),""),l(3),c("Q. ",v(10,8,t.discount,"1.2-2"),""),l(3),c("Q. ",v(13,11,t.unit_price*t.quantity-t.discount*t.quantity,"1.2-2"),"")}}var N=class r{constructor(e,t,a){this.data=e;this.http=t;this.enterpriseService=a;console.log("Data de Constructor: ",e)}aSaleDetail;aUsers=[];_sAuth=u(E);_sSweetAlert=u(V);enterpriseInfor;datePipe=u(O);logocondor="/img/logo.png";apiUrl="https://localhost:7059/api/Enterprise/detail/";ngOnInit(){this._sSweetAlert.showLoading(),this._sAuth.getUsers().subscribe(e=>{e.isSuccess?(this.aUsers=e.value??[],this._sSweetAlert.closeLoading()):this._sSweetAlert.showError("Hubo un error")}),this.aSaleDetail=this.data.payload,this.enterpriseService.getEnterpriseById(1).subscribe(e=>{e.isSuccess?this.enterpriseInfor=e.value:console.error("Error al obtener datos de la empresa:",e.error)})}getEnterpriseById(e){return this.http.get(`${this.apiUrl}${e}`)}getNameUser(e){let t=this.aUsers.find(a=>a.id===e);return t?`${t.firstname.toUpperCase()} ${t.lastname.toUpperCase()}`:"Desconocido"}getSubtotal(){return this.aSaleDetail.products.reduce((e,t)=>e+t.unit_price*t.quantity,0)}getDescuento(){return this.aSaleDetail.products.reduce((e,t)=>e+t.discount*t.quantity,0)}printReceipt(){let e=document.getElementById("receiptContent");(0,Ht.default)(e).then(t=>{let a=new Dt("p","mm","a4"),s=t.toDataURL("image/png"),d=190,$=a.internal.pageSize.height,A=t.height*d/t.width,R=A,L=0;for(a.addImage(s,"PNG",10,L,d,A),R-=$;R>=0;)L=R-A,a.addPage(),a.addImage(s,"PNG",10,L,d,A),R-=$;let Bt=this.datePipe.transform(this.aSaleDetail.saleDate,"dd-MM-yyyy_HH-mm")||"fecha-hora";a.save(`recibo-venta-${Bt}.pdf`)})}static \u0275fac=function(t){return new(t||r)(M(ft),M(rt),M(Tt))};static \u0275cmp=P({type:r,selectors:[["app-historial-detail-popup"]],standalone:!0,features:[tt([O]),I],decls:66,vars:23,consts:[["id","receiptContent",1,"sale-info"],[1,"head"],[1,"info-enterprise"],["alt","Logo",1,"logo",3,"src"],[1,"receipt-title"],[1,"header"],[1,"product-table-container"],[1,"product-table"],[1,"table-header"],["class","table-row",4,"ngFor","ngForOf"],[1,"totals"],[1,"button-container"],["mat-raised-button","",1,"custom-button",3,"click"],[1,"table-row"]],template:function(t,a){t&1&&(i(0,"div",0)(1,"div",1)(2,"section",2),h(3,"img",3),i(4,"p")(5,"strong"),o(6),n()()(),i(7,"h4",4),o(8,"Recibo de Venta"),n()(),i(9,"div",5)(10,"p")(11,"strong"),o(12,"Tel\xE9fono:"),n(),o(13),n(),i(14,"p")(15,"strong"),o(16,"E-mail:"),n(),o(17),n(),i(18,"p")(19,"strong"),o(20,"Direcci\xF3n:"),n(),o(21),n()(),h(22,"hr"),i(23,"p")(24,"strong"),o(25,"Vendedor:"),n(),o(26),n(),i(27,"p")(28,"strong"),o(29,"Fecha de venta:"),n(),o(30),C(31,"date"),n(),i(32,"div",6)(33,"div",7)(34,"div",8)(35,"span"),o(36,"Producto"),n(),i(37,"span"),o(38,"Cantidad"),n(),i(39,"span"),o(40,"Precio Unitario"),n(),i(41,"span"),o(42,"Descuento"),n(),i(43,"span"),o(44,"Total"),n()(),b(45,Jt,14,14,"div",9),n()(),i(46,"div",10)(47,"div")(48,"strong"),o(49,"SubTotal:"),n(),o(50),C(51,"number"),n(),i(52,"div")(53,"strong"),o(54,"Descuento:"),n(),o(55),C(56,"number"),n(),h(57,"hr"),i(58,"div")(59,"strong"),o(60,"TOTAL:"),n(),o(61),C(62,"number"),n()()(),i(63,"div",11)(64,"button",12),g("click",function(){return a.printReceipt()}),o(65,"Imprimir recibo"),n()()),t&2&&(l(3),p("src",a.logocondor,H),l(3),x(a.enterpriseInfor==null?null:a.enterpriseInfor.name),l(7),c(" ",a.enterpriseInfor==null?null:a.enterpriseInfor.phoneNumber,""),l(4),c(" ",a.enterpriseInfor==null?null:a.enterpriseInfor.email,""),l(4),c(" ",a.enterpriseInfor==null?null:a.enterpriseInfor.address,""),l(5),c(" ",a.getNameUser(a.aSaleDetail.iD_User),""),l(4),c(" ",v(31,11,a.aSaleDetail.saleDate,"short"),""),l(15),p("ngForOf",a.aSaleDetail.products),l(5),c(" Q",v(51,14,a.getSubtotal(),"1.2-2"),""),l(5),c(" Q",v(56,17,a.getDescuento(),"1.2-2"),""),l(6),c(" Q",v(62,20,a.aSaleDetail.total,"1.2-2"),""))},dependencies:[O,F,B,at],styles:["div.sale-info[_ngcontent-%COMP%]{font-family:PoppinsRegular;padding-top:30px;padding-bottom:25px}.head[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;font-family:PoppinsBold}.head[_ngcontent-%COMP%]   .info-enterprise[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;text-align:center}.head[_ngcontent-%COMP%]   .info-enterprise[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{max-width:80px}.header[_ngcontent-%COMP%]{margin:10px 0 10px 5%}.header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:5px 0}.header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-family:PoppinsBold}.product-table-container[_ngcontent-%COMP%]{display:flex;justify-content:center;width:100%;margin-top:20px}.product-table[_ngcontent-%COMP%]{width:95%;border-collapse:collapse}.table-header[_ngcontent-%COMP%], .table-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:8px;border-bottom:1px solid var(--txt-color)}.table-header[_ngcontent-%COMP%]{background-color:var(--txt-second-color);font-weight:700}.table-row[_ngcontent-%COMP%]{background-color:var(--blue-pale-color)}.table-row[_ngcontent-%COMP%]:nth-child(2n){background-color:var(--blue-pale-color)}.table-header[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .table-row[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{flex:1;text-align:center}.totals[_ngcontent-%COMP%]{text-align:center;margin-top:10px;font-size:1.1em}.totals[_ngcontent-%COMP%]   div[_ngcontent-%COMP%], hr[_ngcontent-%COMP%]{margin-top:.3em}.totals[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:var(--black-txt-color)}.totals[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:last-child   strong[_ngcontent-%COMP%]{color:var(--bg-red-color)}.button-container[_ngcontent-%COMP%]{display:flex;justify-content:center;margin-top:10px}.custom-button[_ngcontent-%COMP%]{background-color:var(--txt-blue-color);color:var(--white-color)!important;border-radius:5px;padding:5px;font-size:1.3em}.custom-button[_ngcontent-%COMP%]:hover{background-color:var(--txt-color);color:var(--white-color)!important}h4[_ngcontent-%COMP%]{flex:1;text-align:center;font-size:2em;color:var(--primary-color);font-family:PoppinsBold}p[_ngcontent-%COMP%]{margin-left:5%;margin-top:.5em;margin-bottom:.5em}p[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-family:PoppinsBold}"]})};var Yt=()=>[5,10,20];function Kt(r,e){r&1&&(i(0,"th",17),o(1,"Fecha de venta"),n())}function Xt(r,e){if(r&1&&(i(0,"td",18),o(1),C(2,"date"),n()),r&2){let t=e.$implicit;l(),c(" ",v(2,1,t.saleDate,"short")," ")}}function Zt(r,e){r&1&&(i(0,"th",17),o(1,"Usuario"),n())}function te(r,e){if(r&1&&(i(0,"td",18),o(1),n()),r&2){let t=e.$implicit,a=m();l(),c(" ",a.getNameById(t.iD_User)," ")}}function ee(r,e){r&1&&(i(0,"th",17),o(1,"Total de ventas"),n())}function ne(r,e){if(r&1&&(i(0,"td",18),o(1),n()),r&2){let t=e.$implicit;l(),c(" ",t.total," ")}}function ie(r,e){r&1&&(i(0,"th",17),o(1,"Cantidad de producto"),n())}function oe(r,e){if(r&1&&(i(0,"td",18),o(1),n()),r&2){let t=e.$implicit;l(),c(" ",t.productsTotal," ")}}function ae(r,e){r&1&&(i(0,"th",17),o(1,"Acciones"),n())}function re(r,e){if(r&1){let t=S();i(0,"td",19)(1,"div",20)(2,"button",21),g("click",function(){let s=_(t).$implicit,d=m();return f(d.onViewDetails(s.id))}),i(3,"mat-icon"),o(4,"visibility"),n()()()()}}function le(r,e){r&1&&h(0,"tr",22)}function se(r,e){r&1&&h(0,"tr",23)}var q=class r{constructor(e,t,a){this._matDialog=e;this.authService=t;this.sTitle=a;this.sTitle.setTitle("Ventas / Historial")}searchMessage="Buscar ventas";searchInput=null;selectedStartDate;selectedEndDate;_BaseApi=u(U);_AuthS=u(E);_SweetAlerts=u(V);totalItems=0;paginator;dataSource=new Et;paginatorSubscription;displayedColumns=["total","iD_User","saleDate","productsTotal","acciones"];aItemsUser=[];ngOnInit(){this._SweetAlerts.showLoading(),this._AuthS.getUsers().subscribe(e=>{this.aItemsUser=e.value??[],this._SweetAlerts.closeLoading()})}ngAfterViewInit(){this.paginatorSubscription=this.paginator.page.subscribe(()=>this.loadItems()),this.loadItems(),this.paginator.page.subscribe(()=>this.loadItems()),this.loadItems()}onSearch(e){console.log(e)}onViewDetails(e){this._SweetAlerts.showLoading(),this._BaseApi.getDetail("sale",e).subscribe(t=>{t.isSuccess&&(this._SweetAlerts.closeLoading(),this._matDialog.open(N,{width:"550px",height:"100vh",maxHeight:"100vh",position:{right:"0"},panelClass:"dialog-detail",data:{payload:t.value}}))})}filterItems(){this._BaseApi.filter("sale",this.searchInput,this.selectedStartDate,this.selectedEndDate).subscribe(e=>{this.dataSource.data=e.value})}clearFilters(){this.searchInput=null,this.selectedEndDate=null,this.selectedStartDate=null,this.paginator.pageIndex=0,this.loadItems()}loadItems(){this._SweetAlerts.showLoading();let e=this.paginator.pageIndex,t=this.paginator.pageSize;this._BaseApi.getItemsPagination("sale",e+1,t).subscribe(a=>{this._SweetAlerts.closeLoading(),this.dataSource.data=a.items,this.totalItems=a.pagination.TotalItemCount,this.paginator.pageIndex=a.pagination.CurrentPage-1,this.paginator.length=this.totalItems})}getNameById(e){if(this.aItemsUser.length>0){let t=this.aItemsUser.find(a=>a.id==e);return t?t.username:e}else return e}static \u0275fac=function(t){return new(t||r)(M(bt),M(E),M(_t))};static \u0275cmp=P({type:r,selectors:[["app-historial-ventas"]],viewQuery:function(t,a){if(t&1&&K(W,5),t&2){let s;X(s=Z())&&(a.paginator=s.first)}},standalone:!0,features:[I],decls:24,vars:6,consts:[[1,"container"],[1,"main-content"],[1,"flex","flex-wrap","justify-end","items-end","gap-4","mb-4"],[1,"example-container","mat-elevation-z8"],[1,"example-table-container"],["mat-table","","matSort","","matSortActive","created","matSortDisableClear","","matSortDirection","desc",1,"example-table",3,"dataSource"],["matColumnDef","saleDate"],["class","itemHeader","mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","iD_User"],["matColumnDef","total"],["matColumnDef","productsTotal"],["matColumnDef","acciones"],["mat-cell","","class","actions-cell",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","",3,"length","pageSizeOptions"],["mat-header-cell","",1,"itemHeader"],["mat-cell",""],["mat-cell","",1,"actions-cell"],[1,"actions-container"],["mat-icon-button","",1,"btnVer",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(t,a){t&1&&(i(0,"div",0)(1,"main",1),h(2,"div",2),i(3,"div",3)(4,"div",4)(5,"table",5),y(6,6),b(7,Kt,2,0,"th",7)(8,Xt,3,4,"td",8),w(),y(9,9),b(10,Zt,2,0,"th",7)(11,te,2,1,"td",8),w(),y(12,10),b(13,ee,2,0,"th",7)(14,ne,2,1,"td",8),w(),y(15,11),b(16,ie,2,0,"th",7)(17,oe,2,1,"td",8),w(),y(18,12),b(19,ae,2,0,"th",7)(20,re,5,0,"td",13),w(),b(21,le,1,0,"tr",14)(22,se,1,0,"tr",15),n(),h(23,"mat-paginator",16),n()()()()),t&2&&(l(5),p("dataSource",a.dataSource),l(16),p("matHeaderRowDef",a.displayedColumns),l(),p("matRowDefColumns",a.displayedColumns),l(),p("length",a.totalItems)("pageSizeOptions",et(5,Yt)))},dependencies:[lt,Ot,ht,Ct,Pt,vt,xt,yt,St,Mt,wt,It,gt,W,Vt,O],styles:[".container[_ngcontent-%COMP%]{display:flex;width:100%;font-family:PoppinsSemiBold}.main-content[_ngcontent-%COMP%]{width:100%;flex-grow:1}.controls[_ngcontent-%COMP%]{display:flex;align-items:flex-end;justify-content:flex-end;gap:10px;margin-bottom:20px}.controls[_ngcontent-%COMP%]   .search-button[_ngcontent-%COMP%], .controls[_ngcontent-%COMP%]   .add-user-button[_ngcontent-%COMP%]{padding:8px 12px;border:none;color:var(--bg-color);cursor:pointer;border-radius:4px;transition:background .3s ease}.controls[_ngcontent-%COMP%]   .search-button[_ngcontent-%COMP%]:hover, .controls[_ngcontent-%COMP%]   .add-user-button[_ngcontent-%COMP%]:hover{background-color:var(--sky-color)}.controls[_ngcontent-%COMP%]   .date-input[_ngcontent-%COMP%]{border:1px solid orange;border-radius:5px;outline:none;padding:8px}.controls[_ngcontent-%COMP%]   .state-select[_ngcontent-%COMP%], .controls[_ngcontent-%COMP%]   .role-select[_ngcontent-%COMP%], .controls[_ngcontent-%COMP%]   .search-input[_ngcontent-%COMP%]{padding:8px;border:1px solid var(--bg-color);border-radius:4px}.controls[_ngcontent-%COMP%]   .add-user-button[_ngcontent-%COMP%]{background-color:var(--txt-orange-color);font-size:20px;padding:8px 16px}.example-loading-shade[_ngcontent-%COMP%]{position:absolute;inset:0 0 56px;background:#00000026;z-index:1;display:flex;align-items:center;justify-content:center}.example-rate-limit-reached[_ngcontent-%COMP%]{max-width:360px;text-align:center}.mat-column-number[_ngcontent-%COMP%], .mat-column-state[_ngcontent-%COMP%]{width:64px}.mat-column-created[_ngcontent-%COMP%]{width:124px}.list-inputs[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:flex-end;margin:0 0 20px;gap:10px}.custom-dialog-container[_ngcontent-%COMP%]{background-color:red!important;padding:30px;width:30px!important}"]})};var an=[{path:"venta",component:j,canActivate:[()=>u(z).isTokenExpired()?(u(Q).navigate(["/iniciarSesion"]),!1):!0]},{path:"historial",component:q,canActivate:[()=>u(z).isTokenExpired()?(u(Q).navigate(["/iniciarSesion"]),!1):!0]}];export{an as VENTA_ROUTES};
