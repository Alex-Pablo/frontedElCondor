import{a as Oe,b as ke,c as Re,d as Ae}from"./chunk-5R77JXWN.js";import{a as Ie,b as we,c as De,d as Ee,e as Pe,f as Te,g as Me,h as te,i as D,j as oe,k as ae}from"./chunk-QHK7MVTD.js";import{a as ne,b as $}from"./chunk-VPRBATIL.js";import{a as he,b as Ce}from"./chunk-NWSC6Y3H.js";import"./chunk-E4NSLAU5.js";import"./chunk-AESYL7IM.js";import"./chunk-UZQ2FFVI.js";import{a as Fe}from"./chunk-LCRFK72W.js";import{a as me}from"./chunk-WKFV6RTR.js";import{e as S,h as ge,j as Se,l as ye,o as ve,v as xe,x as be}from"./chunk-AQA36TAA.js";import"./chunk-FK6H3RFT.js";import{a as Z,b as fe}from"./chunk-SSM3X36A.js";import{a as M,b as O,c as k,d as R,e as A,f as F,g as V,h as B,i as q,j as H,k as N,l as ie}from"./chunk-3XHLV4H2.js";import{ea as ee}from"./chunk-JMO4GQE3.js";import{k as se}from"./chunk-7UPJZXFQ.js";import{$ as f,$b as T,Ab as p,Bb as c,Db as b,Gb as h,Ib as _,Kc as X,Nb as G,Ob as Q,Pb as U,Ta as l,Tb as r,Ua as W,Ub as I,V as ce,Vb as g,Xb as L,Yb as w,Zb as j,ac as J,da as P,dc as Y,fc as K,la as v,ma as x,mb as m,ob as u,tb as y,vb as ue,wb as _e,xb as o,yb as a,zb as C}from"./chunk-2KSHIZ5A.js";import{f as E}from"./chunk-EQDQRRRY.js";var qe=()=>[5,10,20];function He(e,t){e&1&&(o(0,"th",23),r(1," ID "),a())}function Ne(e,t){if(e&1&&(o(0,"td",24),r(1),a()),e&2){let i=t.$implicit;l(),g(" ",i.id," ")}}function $e(e,t){e&1&&(o(0,"th",23),r(1," Nombre producto "),a())}function Le(e,t){if(e&1&&(o(0,"td",24),r(1),a()),e&2){let i=t.$implicit;l(),g(" ",i.productName," ")}}function je(e,t){e&1&&(o(0,"th",23),r(1," Proveedor"),a())}function ze(e,t){if(e&1&&(o(0,"td",24),r(1),a()),e&2){let i=t.$implicit;l(),g(" ",i.supplierName," ")}}function We(e,t){e&1&&(o(0,"th",23),r(1," Cantidad en inventario "),a())}function Ge(e,t){if(e&1&&(o(0,"td",24),r(1),a()),e&2){let i=t.$implicit;l(),g(" ",i.quantityInStock," ")}}function Qe(e,t){e&1&&(o(0,"th",23),r(1," Cantidad minima "),a())}function Ue(e,t){if(e&1&&(o(0,"td",24),r(1),a()),e&2){let i=t.$implicit;l(),g(" ",i.stockMin," ")}}function Je(e,t){e&1&&(o(0,"th",23),r(1," Estado "),a())}function Ye(e,t){e&1&&r(0," Disponible ")}function Ke(e,t){e&1&&r(0," En proceso ")}function Xe(e,t){e&1&&r(0," Registrado ")}function Ze(e,t){e&1&&r(0," Agotado ")}function et(e,t){if(e&1&&(o(0,"td",24),m(1,Ye,1,0)(2,Ke,1,0)(3,Xe,1,0)(4,Ze,1,0),a()),e&2){let i=t.$implicit;l(),y(i.status=="S"?1:i.status=="E"?2:i.status=="P"?3:i.status=="R"?4:-1)}}function tt(e,t){e&1&&(o(0,"th",23),r(1," Ultima Actualizacion "),a())}function it(e,t){if(e&1&&(o(0,"td",24),r(1),Y(2,"date"),a()),e&2){let i=t.$implicit;l(),g(" ",K(2,1,i.updated_at,"short")," ")}}function nt(e,t){e&1&&(o(0,"th",23),r(1,"Acciones"),a())}function ot(e,t){e&1&&(o(0,"td",25),C(1,"div",26),a())}function at(e,t){e&1&&C(0,"tr",27)}function rt(e,t){e&1&&C(0,"tr",28)}var re=class e{sTitle=f(ee);searchInput=null;selectedStartDate;selectedEndDate;searchMessage="Buscar producto";sItemToSearch;dItemDateStart;dItemDateEnd;dataSource=new ie;_BaseApi=f($);totalItems=0;paginatorSubscription;paginator;ngOnInit(){this.sTitle.setTitle("Inventario")}ngAfterViewInit(){this.paginatorSubscription=this.paginator.page.subscribe(()=>this.loadItems()),this.loadItems(),this.paginator.page.subscribe(()=>this.loadItems()),this.loadItems()}filterItems(){this._BaseApi.filter("inventory",this.searchInput,this.selectedStartDate,this.selectedEndDate).subscribe(t=>{this.dataSource.data=t.value})}clearFilters(){this.searchInput=null,this.selectedEndDate=null,this.selectedStartDate=null,this.paginator.pageIndex=0,this.loadItems()}handleDateRangeChange(t){this.dItemDateEnd=t.endDate,this.dItemDateStart=t.startDate}loadItems(){let t=this.paginator.pageIndex,i=this.paginator.pageSize;this._BaseApi.getItemsPagination("inventory",t+1,i).subscribe(n=>{this.dataSource.data=n.items,this.totalItems=n.pagination.TotalItemCount,this.paginator.pageIndex=n.pagination.CurrentPage-1,this.paginator.length=this.totalItems})}onSearch(t){this.sItemToSearch=t}onOpenModal(){}onEdit(t){}onDelete(t){}displayedColumns=["id","productName","supplierName","quantityInStock","stockMin","status","updated_at","acciones"];static \u0275fac=function(i){return new(i||e)};static \u0275cmp=P({type:e,selectors:[["app-inventory"]],viewQuery:function(i,n){if(i&1&&G(D,5),i&2){let d;Q(d=U())&&(n.paginator=d.first)}},standalone:!0,features:[T],decls:39,vars:10,consts:[[1,"flex","flex-wrap","flex-col"],[1,"flex","flex-wrap","justify-end","items-end","gap-4","mb-4"],[3,"startDateChange","endDateChange","startDate","endDate"],[3,"searchInputChange","searchMessage","searchInput"],["type","button",1,"bg-blue-600","hover:bg-blue-700","text-white","font-medium","py-2","px-4","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-300",3,"click"],["type","button",1,"bg-gray-500","hover:bg-gray-600","text-white","font-medium","py-2","px-4","rounded-md","focus:outline-none","focus:ring-2","focus:ring-gray-300","ml-2",3,"click"],[1,"example-container","mat-elevation-z8"],[1,"example-table-container"],["mat-table","","matSort","","matSortActive","created","matSortDisableClear","","matSortDirection","desc",1,"example-table",3,"dataSource"],["matColumnDef","id"],["class","itemHeader","mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","productName"],["matColumnDef","supplierName"],["matColumnDef","quantityInStock"],["matColumnDef","stockMin"],["matColumnDef","status"],["matColumnDef","updated_at"],["matColumnDef","acciones"],["mat-cell","","class","actions-cell",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","",3,"length","pageSizeOptions"],["mat-header-cell","",1,"itemHeader"],["mat-cell",""],["mat-cell","",1,"actions-cell"],[1,"actions-container"],["mat-header-row",""],["mat-row",""]],template:function(i,n){i&1&&(o(0,"div",0)(1,"div",1)(2,"app-date-start-end",2),j("startDateChange",function(s){return w(n.selectedStartDate,s)||(n.selectedStartDate=s),s})("endDateChange",function(s){return w(n.selectedEndDate,s)||(n.selectedEndDate=s),s}),a(),o(3,"app-input-search",3),j("searchInputChange",function(s){return w(n.searchInput,s)||(n.searchInput=s),s}),a()(),o(4,"div",1)(5,"button",4),h("click",function(){return n.filterItems()}),r(6," Buscar "),a(),o(7,"button",5),h("click",function(){return n.clearFilters()}),r(8," Limpiar "),a()()(),o(9,"div",6)(10,"div",7)(11,"table",8),p(12,9),m(13,He,2,0,"th",10)(14,Ne,2,1,"td",11),c(),p(15,12),m(16,$e,2,0,"th",10)(17,Le,2,1,"td",11),c(),p(18,13),m(19,je,2,0,"th",10)(20,ze,2,1,"td",11),c(),p(21,14),m(22,We,2,0,"th",10)(23,Ge,2,1,"td",11),c(),p(24,15),m(25,Qe,2,0,"th",10)(26,Ue,2,1,"td",11),c(),p(27,16),m(28,Je,2,0,"th",10)(29,et,5,1,"td",11),c(),p(30,17),m(31,tt,2,0,"th",10)(32,it,3,4,"td",11),c(),p(33,18),m(34,nt,2,0,"th",10)(35,ot,2,0,"td",19),c(),m(36,at,1,0,"tr",20)(37,rt,1,0,"tr",21),a(),C(38,"mat-paginator",22),a()()),i&2&&(l(2),L("startDate",n.selectedStartDate)("endDate",n.selectedEndDate),l(),u("searchMessage",n.searchMessage),L("searchInput",n.searchInput),l(8),u("dataSource",n.dataSource),l(25),u("matHeaderRowDef",n.displayedColumns),l(),u("matRowDefColumns",n.displayedColumns),l(),u("length",n.totalItems)("pageSizeOptions",J(9,qe)))},dependencies:[te,N,M,k,V,R,O,B,A,F,q,H,oe,D,ae,X]})};var le=class e{generateOrderDocument(t){let i=new Fe;i.setFontSize(12),i.text("Detalles del Pedido",10,10),i.text(`ID del Pedido: ${t.supplierId}`,10,20),i.text(`Estado: ${t.status}`,10,30),i.text("Productos:",10,40);let n=50;t.products.forEach(d=>{i.text(`- Producto: ${d.name}`,10,n),i.text(`  Cantidad: ${d.quantity}`,10,n+10),i.text(`  Precio: $${d.price}`,10,n+20),n+=30}),i.save(`pedido-${t.supplierId}.pdf`)}static \u0275fac=function(i){return new(i||e)};static \u0275prov=ce({token:e,factory:e.\u0275fac,providedIn:"root"})};var dt=(e,t)=>t.id;function st(e,t){if(e&1){let i=b();o(0,"div",7),h("click",function(){let d=v(i).$implicit,s=_(2);return x(s.addSupplier(d.id))}),o(1,"h5",8),r(2),a(),o(3,"p",9),r(4),a(),o(5,"p",9),r(6),a()()}if(e&2){let i=t.$implicit;l(2),I(i.name),l(2),I(i.nameContact),l(2),I(i.phoneNumber)}}function mt(e,t){if(e&1&&(p(0),o(1,"p"),r(2,"Selecione un proveedor"),a(),o(3,"div",5),ue(4,st,7,3,"div",6,dt),a(),c()),e&2){let i=_();l(4),_e(i.aSuppliers)}}function pt(e,t){if(e&1){let i=b();o(0,"button",36),h("click",function(){v(i);let d=_(2);return x(d.resetSupplier())}),r(1,"Cambiar proveedor"),a()}}function ct(e,t){e&1&&(o(0,"th",37),r(1,"Nombre"),a())}function ut(e,t){if(e&1&&(o(0,"td",38),r(1),a()),e&2){let i=t.$implicit;l(),I(i.name)}}function _t(e,t){e&1&&(o(0,"th",37),r(1,"Precio de compra"),a())}function ft(e,t){if(e&1&&(o(0,"td",38),r(1),a()),e&2){let i=t.$implicit;l(),I(i.price)}}function ht(e,t){e&1&&(o(0,"th",37),r(1,"Cantidad"),a())}function Ct(e,t){if(e&1&&(o(0,"td",38),r(1),a()),e&2){let i=t.$implicit;l(),I(i.quantity)}}function gt(e,t){e&1&&(o(0,"th",37),r(1,"Acciones"),a())}function St(e,t){if(e&1){let i=b();o(0,"button",43),h("click",function(){v(i);let d=_().index,s=_(2);return x(s.removeProduct(d))}),o(1,"mat-icon"),r(2,"delete"),a()()}}function yt(e,t){if(e&1){let i=b();o(0,"td",39)(1,"div",40),m(2,St,3,0,"button",41),o(3,"button",42),h("click",function(){let d=v(i).index,s=_(2);return x(s.editProduct(d))}),o(4,"mat-icon"),r(5,"edit"),a()()()()}if(e&2){let i=_(2);l(2),y(i.isEditMode?-1:2)}}function vt(e,t){e&1&&C(0,"tr",44)}function xt(e,t){e&1&&C(0,"tr",45)}function bt(e,t){if(e&1&&(o(0,"div",35),C(1,"app-input-select",46),a()),e&2){let i=_(2);l(),u("options",i.aStatus)("control",i.getFormControl("status"))}}function It(e,t){if(e&1){let i=b();o(0,"div",10)(1,"p"),r(2,"Proveedor selecionado: "),o(3,"span",11),r(4),a()(),m(5,pt,2,0,"button",12),a(),o(6,"div",13)(7,"div",14)(8,"div",15),C(9,"app-input-select",16),a(),o(10,"div",17),C(11,"app-input-field",18),a(),o(12,"div",17),C(13,"app-input-field",19),a(),o(14,"button",20),h("click",function(){v(i);let d=_();return x(d.addProductToOrder())}),r(15,"Agregar producto"),a()(),o(16,"div")(17,"p",21),r(18,"Lista de productos"),a(),o(19,"div",22)(20,"div",23)(21,"div",24)(22,"table",25),p(23,26),m(24,ct,2,0,"th",27)(25,ut,2,1,"td",28),c(),p(26,29),m(27,_t,2,0,"th",27)(28,ft,2,1,"td",28),c(),p(29,30),m(30,ht,2,0,"th",27)(31,Ct,2,1,"td",28),c(),p(32,31),m(33,gt,2,0,"th",27)(34,yt,6,1,"td",32),c(),m(35,vt,1,0,"tr",33)(36,xt,1,0,"tr",34),a()()()()(),m(37,bt,2,2,"div",35),a()}if(e&2){let i,n=_();l(4),I(n.getSupplier()),l(),y(n.isEditMode==!1?5:-1),l(4),u("options",n.aProducts)("control",n.getFormControl("selectedProductId")),l(2),u("control",n.getFormControl("price")),l(2),u("control",n.getFormControl("quantity")),l(9),u("dataSource",(i=n.fOrder.get("products"))==null?null:i.value),l(13),u("matHeaderRowDef",n.displayColumns),l(),u("matRowDefColumns",n.displayColumns),l(),y(n.isEditMode?37:-1)}}var z=class e{constructor(t){this.data=t;this.isEditMode=!!t.payload,this.buildForm(this.data)}_MatDialgoRef=f(Ie);_sBaseApi=f($);_sSweetalert=f(ne);_documentService=f(le);_fb=f(xe);aSuppliers;aProducts;aStatus;fOrder=this._fb.group({});selectedProduct;editingIndex=null;isEditMode;ngOnInit(){this.getSuppliers(),this.fOrder.get("selectedProductId")?.valueChanges.subscribe(t=>{this.onProductSelected(t)}),this.fOrder.get("status")?.valueChanges.subscribe(t=>E(this,null,function*(){if(t==="E"){let i=yield this._sSweetalert.showNotification(`Una vez cambiando el estado a en proceso ya no se podr\xE1 modificar el pedido.
 \xBFYa notificaste el pedido al proveedor?`)}})),this.data?.payload?.supplierId&&this.getProductsBySupplier(this.data?.payload?.supplierId),this.getStatus()}onProductSelected(t){t>0&&(this.selectedProduct=this.aProducts.find(i=>i.id==t),this.selectedProduct&&this.fOrder.patchValue({price:this.selectedProduct.purchasePrice}))}editProduct(t){let n=this.fOrder.get("products").at(t).value;this.fOrder.patchValue({selectedProductId:n.productId,price:n.price,quantity:n.quantity}),this.editingIndex=t}updateProduct(){this.editingIndex!==null&&(this.fOrder.get("products").at(this.editingIndex).patchValue({productId:this.fOrder.get("selectedProductId")?.value,name:this.selectedProduct?.name||"",price:this.fOrder.get("price")?.value,quantity:this.fOrder.get("quantity")?.value}),this.resetProductForm(),this.editingIndex=null)}onSubmit(){if(this.fOrder.valid&&this.fOrder.get("products")?.value.length>0){this._sSweetalert.showLoading();let t={supplierId:this.fOrder.get("idSupplier")?.value,products:this.fOrder.get("products")?.value,status:this.fOrder.get("status")?.value};this.isEditMode?this._sBaseApi.updateItem("order",t,this.data.payload.id).subscribe({next:i=>E(this,null,function*(){if(i.isSuccess){let n=yield this._sSweetalert.showNotification("El PDF se ha descargado.Env\xEDalo al proveedor para su notificacion");this._MatDialgoRef.close(!0)}else this._sSweetalert.showError("Error al editar pedido")}),error:i=>{this._sSweetalert.closeLoading(),this._sSweetalert.showError("Ocurri\xF3 un error al comunicarse con el servidor")}}):this._sBaseApi.addItem("order",t).subscribe({next:i=>E(this,null,function*(){if(this._sSweetalert.closeLoading(),i.isSuccess){let n=yield this._sSweetalert.showNotification("El PDF se ha descargado.Env\xEDa al proveedor y cambia el estado a 'En proceso'.");this._MatDialgoRef.close(!0)}else this._sSweetalert.showError("Error al crear el pedido")}),error:i=>{this._sSweetalert.closeLoading(),this._sSweetalert.showError("Ocurri\xF3 un error al comunicarse con el servidor")}})}else this._sSweetalert.showError("Formulario inv\xE1lido o sin productos")}addSupplier(t){this.fOrder.patchValue({idSupplier:t}),this.getProductsBySupplier(t)}resetSupplier(){this.fOrder.patchValue({idSupplier:null,products:[],selectedProductId:null,price:null,quantity:null})}getSupplier(){let i=(this.aSuppliers??[]).find(n=>n.id==this.fOrder.get("idSupplier")?.value);return i?i.nameContact:"No proveedor"}getProductsBySupplier(t){this._sSweetalert.showLoading(),this._sBaseApi.getItemBy("Product/supplier",t).subscribe(i=>{i.isSuccess&&(this._sSweetalert.closeLoading(),this.aProducts=i.value)})}getSuppliers(){this._sSweetalert.showLoading(),this._sBaseApi.getItems("Supplier").subscribe(t=>{t.isSuccess&&(this.aSuppliers=t.value,this._sSweetalert.closeLoading())})}buildForm(t){this.fOrder=this._fb.group({idSupplier:[t?.payload?.supplierId||null,[S.required]],status:[t?.payload?.status||"P",[S.required]],products:this._fb.array(t?.payload?.products?.map(i=>{let n=this.aProducts?.find(d=>d.id==i.productId);return this._fb.group({id:[i.id],productId:[i.productId,[S.required]],price:[i.price,[S.required,S.min(0)]],quantity:[i.quantity,[S.required,S.min(1)]],name:[n?n.name:"producto"]})})||[]),selectedProductId:[null],price:[null],quantity:[null,[S.min(1)]]})}addProductToOrder(){if(this.editingIndex!==null)this.updateProduct();else if(this.fOrder.get("quantity")?.value>0){let t=this.fOrder.get("products"),i=this._fb.group({productId:[this.fOrder.get("selectedProductId")?.value,S.required],name:[this.selectedProduct?.name||"",S.required],price:[this.fOrder.get("price")?.value,S.required],quantity:[this.fOrder.get("quantity")?.value,[S.required,S.min(1)]]});t.push(i),this.resetProductForm()}}removeProduct(t){this.fOrder.get("products").removeAt(t)}resetProductForm(){this.fOrder.patchValue({selectedProductId:null,price:null,quantity:null}),this.selectedProduct=null,this.editingIndex=null}getFormControl(t){let i=this.fOrder.get(t);return i instanceof Se?i:null}displayColumns=["name","price","quantity","acciones"];getStatus(){this.aStatus=[{id:"P",name:"Pendiente (Aun no se ha notificado al proveedor)"},{id:"E",name:"En proceso (Se ha notificado al proveedor)"}]}static \u0275fac=function(i){return new(i||e)(W(we))};static \u0275cmp=P({type:e,selectors:[["app-order-popup"]],standalone:!0,features:[T],decls:10,vars:3,consts:[["mat-dialog-title","",1,"text-bol"],[1,"mat-typography","w-full"],[1,"mt-4",3,"formGroup"],["align","end"],[3,"click"],[1,"w-full","flex","flex-row","gap-4","flex-wrap"],[1,"border","rounded-lg","p-4","cursor-pointer","hover:bg-gray-500/10"],[1,"border","rounded-lg","p-4","cursor-pointer","hover:bg-gray-500/10",3,"click"],[1,"text-sm","font-medium","text-gray-900"],[1,"text-sm","text-gray-500"],[1,"w-full","flex","flex-row","align-baseline","gap-20"],[1,"text-blue-950","font-bold"],["type","button",1,"bg-white","hover:bg-gray-100","text-gray-800","font-semibold","py-2","px-4","border","border-gray-400","rounded","shadow"],[1,"mt-4"],[1,"flex","flex-wrap","md:mb-6"],[1,"w-full","md:w-1/2","px-3","mb-6","md:mb-0","sm:w-full"],["label","Productos","placeholder","",3,"options","control"],[1,"w-full","md:w-1/4","px-3","mb-6","md:mb-0","sm:w-full"],["label","Precio de compra","type","number","placeholder","Ingrese el precio de compra",3,"control"],["label","Cantidad","type","number","placeholder","Cantidad del pedido",3,"control"],["type","button",1,"bg-blue-500","hover:bg-blue-700","text-white","font-bold","py-2","px-4","rounded","m-4",3,"click"],[1,"font-bold"],[1,"table-container"],[1,"example-container","mat-elevation-z8"],[1,"example-table-container"],["mat-table","","matSort","","matSortActive","created","matSortDisableClear","","matSortDirection","desc",1,"example-table",3,"dataSource"],["matColumnDef","name"],["class","itemHeader","mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","price"],["matColumnDef","quantity"],["matColumnDef","acciones"],["mat-cell","","class","actions-cell",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[1,"w-full","md:w-1/2","px-3","mb-6","md:mb-0","sm:w-full","mt-6"],["type","button",1,"bg-white","hover:bg-gray-100","text-gray-800","font-semibold","py-2","px-4","border","border-gray-400","rounded","shadow",3,"click"],["mat-header-cell","",1,"itemHeader"],["mat-cell",""],["mat-cell","",1,"actions-cell"],[1,"actions-container"],["mat-icon-button","",1,"btnEliminar"],["mat-icon-button","",1,"btnEditar",3,"click"],["mat-icon-button","",1,"btnEliminar",3,"click"],["mat-header-row",""],["mat-row",""],["label","Estado","placeholder","Selecione un estado",3,"options","control"]],template:function(i,n){if(i&1&&(o(0,"h3",0),r(1),a(),o(2,"mat-dialog-content",1),C(3,"mat-divider"),o(4,"form",2),m(5,mt,6,0,"ng-container")(6,It,38,10),a()(),o(7,"mat-dialog-actions",3)(8,"app-btn-close",4),h("click",function(){return n._MatDialgoRef.close(!1)}),a(),o(9,"app-btn-accept",4),h("click",function(){return n.onSubmit()}),a()()),i&2){let d;l(),I(n.isEditMode?"Editar pedido":"Nuevo pedido"),l(3),u("formGroup",n.fOrder),l(),y(((d=n.fOrder.get("idSupplier"))==null?null:d.value)==null?5:6)}},dependencies:[Me,Ee,Te,Pe,ke,Oe,Ce,he,be,ye,ge,ve,Ae,Re,N,M,k,V,R,O,B,A,F,q,H,fe,Z]})};var wt=()=>[5,10,20];function Dt(e,t){e&1&&(o(0,"th",21),r(1," Pedido "),a())}function Et(e,t){if(e&1&&(o(0,"td",22),r(1),a()),e&2){let i=t.$implicit;l(),g(" ",i.id," ")}}function Pt(e,t){e&1&&(o(0,"th",21),r(1," Proveedor (Empresa) "),a())}function Tt(e,t){if(e&1&&(o(0,"td",22),r(1),a()),e&2){let i=t.$implicit;l(),g(" ",i.supplier," ")}}function Mt(e,t){e&1&&(o(0,"th",21),r(1,"Proveedor Contacto"),a())}function Ot(e,t){if(e&1&&(o(0,"td",22),r(1),a()),e&2){let i=t.$implicit;l(),g(" ",i.supplierContact," ")}}function kt(e,t){e&1&&(o(0,"th",21),r(1," Productos pedidos "),a())}function Rt(e,t){if(e&1&&(o(0,"td",22),r(1),a()),e&2){let i=t.$implicit;l(),g(" ",i.productsTotal," ")}}function At(e,t){e&1&&(o(0,"th",21),r(1," Total del pedido"),a())}function Ft(e,t){if(e&1&&(o(0,"td",22),r(1),a()),e&2){let i=t.$implicit;l(),g(" ",i.priceTotal," ")}}function Vt(e,t){e&1&&(o(0,"th",21),r(1,"Fecha pedido"),a())}function Bt(e,t){if(e&1&&(o(0,"td",22),r(1),Y(2,"date"),a()),e&2){let i=t.$implicit;l(),g(" ",K(2,1,i.timeOrder,"short")," ")}}function qt(e,t){e&1&&(o(0,"th",21),r(1,"Estado"),a())}function Ht(e,t){e&1&&r(0," Completado ")}function Nt(e,t){e&1&&r(0," Pendiente ")}function $t(e,t){e&1&&r(0," En Proceso ")}function Lt(e,t){e&1&&r(0," Completado ")}function jt(e,t){e&1&&r(0," No Pagado ")}function zt(e,t){if(e&1&&(o(0,"td",22),m(1,Ht,1,0)(2,Nt,1,0)(3,$t,1,0)(4,Lt,1,0)(5,jt,1,0),a()),e&2){let i=t.$implicit;l(),y(i.status=="C"?1:i.status=="P"?2:i.status=="E"?3:i.status=="C"?4:i.status=="N"?5:-1)}}function Wt(e,t){e&1&&(o(0,"th",21),r(1,"acciones"),a())}function Gt(e,t){if(e&1){let i=b();o(0,"button",29),h("click",function(){v(i);let d=_().$implicit,s=_();return x(s.modifyOrder(d.id))}),o(1,"mat-icon"),r(2,"edit"),a()()}}function Qt(e,t){if(e&1){let i=b();o(0,"button",30),h("click",function(){v(i);let d=_().$implicit,s=_();return x(s.reciveOrder(d.id))}),r(1," Recibir "),a()}}function Ut(e,t){if(e&1){let i=b();o(0,"button",31),h("click",function(){v(i);let d=_().$implicit,s=_();return x(s.reciveOrder(d.id))}),r(1," Pagar "),a()}}function Jt(e,t){if(e&1){let i=b();o(0,"td",23)(1,"div",24)(2,"button",25),h("click",function(){let d=v(i).$implicit,s=_();return x(s.onViewDetails(d.id))}),o(3,"mat-icon"),r(4,"visibility"),a()(),m(5,Gt,3,0,"button",26)(6,Qt,2,0,"button",27)(7,Ut,2,0,"button",28),a()()}if(e&2){let i=t.$implicit;l(5),y(i.status=="P"?5:-1),l(),y(i.status=="E"?6:-1),l(),y(i.status=="N"?7:-1)}}function Yt(e,t){e&1&&C(0,"tr",32)}function Kt(e,t){e&1&&C(0,"tr",33)}var de=class e{constructor(t){this._matDialog=t}sTitle=f(ee);_sBaseApi=f($);totalItems=0;_sSweetalert=f(ne);sItemToSearch;dItemDateStart;dItemDateEnd;selectedStartDate;selectedEndDate;searchInput=null;paginatorSubscription;paginator;searchMessage="Buscar pedido";dataSource=new ie;ngOnInit(){this.sTitle.setTitle("Lista de pedidos")}ngAfterViewInit(){this.paginatorSubscription=this.paginator.page.subscribe(()=>this.loadItems()),this.loadItems(),this.paginator.page.subscribe(()=>this.loadItems()),this.loadItems()}filterItems(){this._sBaseApi.filter("inventory",this.searchInput,this.selectedStartDate,this.selectedEndDate).subscribe(t=>{this.dataSource.data=t.value})}clearFilters(){this.searchInput=null,this.selectedEndDate=null,this.selectedStartDate=null,this.paginator.pageIndex=0,this.loadItems()}loadItems(){let t=this.paginator.pageIndex,i=this.paginator.pageSize;this._sBaseApi.getItemsPagination("order",t+1,i).subscribe(n=>{this.dataSource.data=n.items,this.totalItems=n.pagination.TotalItemCount,this.paginator.pageIndex=n.pagination.CurrentPage-1,this.paginator.length=this.totalItems})}onSearch(t){}getOrders(){this._sSweetalert.showLoading(),this._sBaseApi.getItems("order").subscribe(t=>{this.dataSource=t.value,this._sSweetalert.closeLoading()})}newOrder(){this._matDialog.open(z,{height:"890vh",maxHeight:"90vh",width:"85vw",maxWidth:"85vw",disableClose:!0,data:{}}).afterClosed().subscribe(t=>{t&&this.loadItems()})}modifyOrder(t){this._sBaseApi.getItemBy("order",t).subscribe(i=>{i.isSuccess&&this._matDialog.open(z,{height:"890vh",maxHeight:"90vh",width:"85vw",maxWidth:"85vw",disableClose:!0,data:{payload:i.value}}).afterClosed().subscribe(n=>{n&&this.loadItems()})})}reciveOrder(t){this._sSweetalert.showConfirmation2(`\xBFRecibistes los productos realizados en el pedido: ${t}?`,"Cancelar","Si, lo recibi",()=>{this._sBaseApi.receiveItems(t).subscribe({next:i=>E(this,null,function*(){if(i.isSuccess){let n=yield this._sSweetalert.showNotification("Se a actualizado el inventario con los productos recibidos");this.loadItems()}else this._sSweetalert.showError("Error al editar pedido")}),error:i=>{this._sSweetalert.closeLoading(),this._sSweetalert.showError("Ocurri\xF3 un error al comunicarse con el servidor")}})})}onViewDetails(t){}onEdit(t){}onDelete(t){}displayedColumns=["id","supplier","supplierContact","productsTotal","priceTotal","timeOrder","status","acciones"];static \u0275fac=function(i){return new(i||e)(W(De))};static \u0275cmp=P({type:e,selectors:[["app-pedidos"]],viewQuery:function(i,n){if(i&1&&G(D,5),i&2){let d;Q(d=U())&&(n.paginator=d.first)}},standalone:!0,features:[T],decls:35,vars:9,consts:[[1,"flex","flex-wrap","justify-end","gap-2","mb-4"],[3,"startDateChange","endDateChange","startDate","endDate"],[3,"searchChange","searchMessage"],["type","button",1,"bg-sky-500/80","px-3","py-2","text-white","rounded","font-bold","hover:bg-sky-500/60",3,"click"],[1,"example-container","mat-elevation-z8"],[1,"example-table-container"],["mat-table","","matSort","","matSortActive","created","matSortDisableClear","","matSortDirection","desc",1,"example-table",3,"dataSource"],["matColumnDef","id"],["class","itemHeader","mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","supplier"],["matColumnDef","supplierContact"],["matColumnDef","productsTotal"],["matColumnDef","priceTotal"],["matColumnDef","timeOrder"],["matColumnDef","status"],["matColumnDef","acciones"],["mat-cell","","class","actions-cell",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","",3,"length","pageSizeOptions"],["mat-header-cell","",1,"itemHeader"],["mat-cell",""],["mat-cell","",1,"actions-cell"],[1,"actions-container"],["mat-icon-button","",1,"btnVer",3,"click"],["mat-icon-button","",1,"btnEditar"],["mat-icon-button","",1,"text-green-600","font-bold"],["mat-icon-button","",1,"text-red-600","font-bold"],["mat-icon-button","",1,"btnEditar",3,"click"],["mat-icon-button","",1,"text-green-600","font-bold",3,"click"],["mat-icon-button","",1,"text-red-600","font-bold",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(i,n){i&1&&(o(0,"div",0)(1,"app-date-start-end",1),j("startDateChange",function(s){return w(n.selectedStartDate,s)||(n.selectedStartDate=s),s})("endDateChange",function(s){return w(n.selectedEndDate,s)||(n.selectedEndDate=s),s}),a(),o(2,"app-input-search",2),h("searchChange",function(s){return n.onSearch(s)}),a(),o(3,"button",3),h("click",function(){return n.newOrder()}),r(4,"Crear pedido"),a()(),o(5,"div",4)(6,"div",5)(7,"table",6),p(8,7),m(9,Dt,2,0,"th",8)(10,Et,2,1,"td",9),c(),p(11,10),m(12,Pt,2,0,"th",8)(13,Tt,2,1,"td",9),c(),p(14,11),m(15,Mt,2,0,"th",8)(16,Ot,2,1,"td",9),c(),p(17,12),m(18,kt,2,0,"th",8)(19,Rt,2,1,"td",9),c(),p(20,13),m(21,At,2,0,"th",8)(22,Ft,2,1,"td",9),c(),p(23,14),m(24,Vt,2,0,"th",8)(25,Bt,3,4,"td",9),c(),p(26,15),m(27,qt,2,0,"th",8)(28,zt,6,1,"td",9),c(),p(29,16),m(30,Wt,2,0,"th",8)(31,Jt,8,3,"td",17),c(),m(32,Yt,1,0,"tr",18)(33,Kt,1,0,"tr",19),a(),C(34,"mat-paginator",20),a()()),i&2&&(l(),L("startDate",n.selectedStartDate)("endDate",n.selectedEndDate),l(),u("searchMessage",n.searchMessage),l(5),u("dataSource",n.dataSource),l(25),u("matHeaderRowDef",n.displayedColumns),l(),u("matRowDefColumns",n.displayedColumns),l(),u("length",n.totalItems)("pageSizeOptions",J(8,wt)))},dependencies:[te,Z,N,M,k,V,R,O,B,A,F,q,H,X,ae,D,oe]})};var rn=[{path:"inventario",component:re,canActivate:[()=>f(me).isTokenExpired()?(f(se).navigate(["/iniciarSesion"]),!1):!0]},{path:"pedidos",component:de,canActivate:[()=>f(me).isTokenExpired()?(f(se).navigate(["/iniciarSesion"]),!1):!0]},{path:"",redirectTo:"inventario",pathMatch:"full"}];export{rn as CATALOGO_ROUTES};
